

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>despasito.input_output.readwrite_input &mdash; DESPASITO  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> DESPASITO
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../input_output.html">Input/Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../eos.html">Equations of State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../thermo.html">Thermodynamic Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fitparams.html">Parametrization</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">DESPASITO</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>despasito.input_output.readwrite_input</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for despasito.input_output.readwrite_input</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">Routines for passing input files from .json files to dictionaries and extracting relevant information for program use, as well as write properly structures .json files for later calculations.</span>
<span class="sd">    </span>
<span class="sd">.. todo::</span>
<span class="sd">    * extract_calc_data input_fname: Add link to available thermodynamic calculations</span>
<span class="sd">    * extract_calc_data density_fname: Add link to available density options</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1">######################################################################</span>
<span class="c1">#                                                                    #</span>
<span class="c1">#                   Appends path to find data files                  #</span>
<span class="c1">#                                                                    #</span>
<span class="c1">######################################################################</span>

<div class="viewcode-block" id="append_data_file_path"><a class="viewcode-back" href="../../../_autosummary/despasito.input_output.readwrite_input.append_data_file_path.html#despasito.input_output.readwrite_input.append_data_file_path">[docs]</a><span class="k">def</span> <span class="nf">append_data_file_path</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Appends path to data file(s).</span>

<span class="sd">   Parameters</span>
<span class="sd">   ----------</span>
<span class="sd">   input_dict</span>
<span class="sd">       Dictionary of input (json) data </span>
<span class="sd">   path: str</span>
<span class="sd">       relative path to append to existing data files </span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="s1">&#39;SAFTgroup&#39;</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="p">:</span>
      <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;SAFTgroup&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;SAFTgroup&#39;</span><span class="p">])</span>

   <span class="k">if</span> <span class="s1">&#39;SAFTcross&#39;</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="p">:</span>
      <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;SAFTcross&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;SAFTcross&#39;</span><span class="p">])</span>

   <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
         <span class="n">input_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">])</span></div>

<span class="c1">######################################################################</span>
<span class="c1">#                                                                    #</span>
<span class="c1">#                  Extract Bead Data                                 #</span>
<span class="c1">#                                                                    #</span>
<span class="c1">######################################################################</span>
<div class="viewcode-block" id="extract_calc_data"><a class="viewcode-back" href="../../../_autosummary/despasito.input_output.readwrite_input.extract_calc_data.html#despasito.input_output.readwrite_input.extract_calc_data">[docs]</a><span class="k">def</span> <span class="nf">extract_calc_data</span><span class="p">(</span><span class="n">input_fname</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses dictionary from .json input file to process and divide information into two dictionaries, one for creating the equation of state, and one for the thermodynamic calculations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input_fname : str</span>
<span class="sd">        The file name of a .json file in the current directory containing (1) the paths to equation of state parameters, (2) calculation type and inputs for thermodynamic calculations.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    eos_dict : dict</span>
<span class="sd">        Dictionary of bead definitions and parameters used to later initialize eos object</span>
<span class="sd">    thermo_dict : dict</span>
<span class="sd">        Dictionary of instructions for thermodynamic calculations or parameter fitting</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1">## Extract dictionary from input file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_fname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
        <span class="n">input_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="c1"># Look for data (library) files in the user-supplied path</span>
    <span class="n">append_data_file_path</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;output_file&quot;</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">input_dict</span><span class="p">[</span><span class="s2">&quot;output_file&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1">## Make bead data dictionary for EOS</span>
    <span class="c1">#process input file</span>
    <span class="n">xi</span><span class="p">,</span> <span class="n">beads</span><span class="p">,</span> <span class="n">nui</span> <span class="o">=</span> <span class="n">process_bead_data</span><span class="p">(</span><span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;beadconfig&#39;</span><span class="p">])</span>
    <span class="n">eos_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xi&#39;</span><span class="p">:</span><span class="n">xi</span><span class="p">,</span><span class="s1">&#39;beads&#39;</span><span class="p">:</span><span class="n">beads</span><span class="p">,</span><span class="s1">&#39;nui&#39;</span><span class="p">:</span><span class="n">nui</span><span class="p">}</span>

    <span class="c1">#read SAFT groups file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;SAFTgroup&#39;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">eos_dict</span><span class="p">[</span><span class="s1">&#39;beadlibrary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

    <span class="c1">#read SAFT cross file</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;SAFTcross&#39;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">eos_dict</span><span class="p">[</span><span class="s1">&#39;crosslibrary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cross interaction parameters have been accepted&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No SAFTcross file specified&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">eos_dict</span><span class="p">[</span><span class="s1">&#39;sitenames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;association_site_names&#39;</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Association sites have been accepted&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;No association sites specified&#39;</span><span class="p">)</span>

    <span class="c1">## Make dictionary of data needed for thermodynamic calculation</span>
    <span class="n">thermo_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Extract relevant system state inputs</span>
    <span class="n">EOS_dict_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;beadconfig&#39;</span><span class="p">,</span> <span class="s1">&#39;SAFTgroup&#39;</span><span class="p">,</span> <span class="s1">&#39;SAFTcross&#39;</span><span class="p">,</span><span class="s1">&#39;association_site_names&#39;</span><span class="p">,</span><span class="s2">&quot;output_file&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">EOS_dict_keys</span><span class="p">:</span>
            <span class="n">thermo_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">if</span> <span class="s2">&quot;opt_params&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">thermo_dict</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The following thermo calculation parameters have been provided: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thermo_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))))</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># parameter fitting</span>
        <span class="n">thermo_dict</span> <span class="o">=</span> <span class="n">process_param_fit_inputs</span><span class="p">(</span><span class="n">thermo_dict</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">thermo_dict</span><span class="p">[</span><span class="s2">&quot;exp_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">tmp</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">),&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The bead, </span><span class="si">{}</span><span class="s2">, will have the parameters </span><span class="si">{}</span><span class="s2">, fit using the following data:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thermo_dict</span><span class="p">[</span><span class="s2">&quot;opt_params&quot;</span><span class="p">][</span><span class="s2">&quot;fit_bead&quot;</span><span class="p">],</span><span class="n">thermo_dict</span><span class="p">[</span><span class="s2">&quot;opt_params&quot;</span><span class="p">][</span><span class="s2">&quot;fit_params&quot;</span><span class="p">],</span><span class="n">tmp</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">eos_dict</span><span class="p">,</span> <span class="n">thermo_dict</span><span class="p">,</span> <span class="n">output_file</span></div>

<span class="c1">######################################################################</span>
<span class="c1">#                                                                    #</span>
<span class="c1">#                  Extract Density Plot  Parameters                  #</span>
<span class="c1">#                                                                    #</span>
<span class="c1">######################################################################</span>
<div class="viewcode-block" id="file2paramdict"><a class="viewcode-back" href="../../../_autosummary/despasito.input_output.readwrite_input.file2paramdict.html#despasito.input_output.readwrite_input.file2paramdict">[docs]</a><span class="k">def</span> <span class="nf">file2paramdict</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converted file directly into a dictionary where each line is a key followed by a value.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        File of keys and values</span>
<span class="sd">    delimiter : str, Optional, default: &quot; &quot;</span>
<span class="sd">        String separating key and value within file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dictionary : dict</span>
<span class="sd">        Resulting dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">dictionary</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span>  <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">filedata</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">filedata</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="n">linearray</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linearray</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">dictionary</span><span class="p">[</span><span class="n">linearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">linearray</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                        <span class="n">dictionary</span><span class="p">[</span><span class="n">linearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linearray</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dictionary</span><span class="p">[</span><span class="n">linearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">linearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">dictionary</span></div>

<span class="c1">######################################################################</span>
<span class="c1">#                                                                    #</span>
<span class="c1">#                  Extract Saft Parameters                           #</span>
<span class="c1">#                                                                    #</span>
<span class="c1">######################################################################</span>
<div class="viewcode-block" id="write_SAFTgroup"><a class="viewcode-back" href="../../../_autosummary/despasito.input_output.readwrite_input.write_SAFTgroup.html#despasito.input_output.readwrite_input.write_SAFTgroup">[docs]</a><span class="k">def</span> <span class="nf">write_SAFTgroup</span><span class="p">(</span><span class="n">library</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sort and export dictionary of input SAFT parameters into .json file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    library : dict</span>
<span class="sd">        Dictionary of parameters to be sorted and exported </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Filename (with or without path) of .json file of parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1">#sort and write SAFT dic</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">library</span><span class="p">:</span>
        <span class="n">library</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">library</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">library</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>


<span class="c1">######################################################################</span>
<span class="c1">#                                                                    #</span>
<span class="c1">#                  Make Mole Frac. Matrix                            #</span>
<span class="c1">#                                                                    #</span>
<span class="c1">######################################################################</span>
<div class="viewcode-block" id="make_xi_matrix"><a class="viewcode-back" href="../../../_autosummary/despasito.input_output.readwrite_input.make_xi_matrix.html#despasito.input_output.readwrite_input.make_xi_matrix">[docs]</a><span class="k">def</span> <span class="nf">make_xi_matrix</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract system information from input .json file of parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Name of .json file containing system and thermodynamic information. This function deals with the system information.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xi : list[float]</span>
<span class="sd">        Mole fraction of component, only relevant for parameter fitting</span>
<span class="sd">    beads : list[str]</span>
<span class="sd">        List of unique bead names used among components</span>
<span class="sd">    nui : numpy.ndarray</span>
<span class="sd">        Array of number of components by number of bead types. Defines the number of each type of group in each component.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">comp</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">xi</span><span class="p">,</span> <span class="n">beads</span><span class="p">,</span> <span class="n">nui</span> <span class="o">=</span> <span class="n">process_bead_data</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xi</span><span class="p">,</span> <span class="n">beads</span><span class="p">,</span> <span class="n">nui</span></div>


<span class="c1">######################################################################</span>
<span class="c1">#                                                                    #</span>
<span class="c1">#                  Process Bead Data                                 #</span>
<span class="c1">#                                                                    #</span>
<span class="c1">######################################################################</span>
<div class="viewcode-block" id="process_bead_data"><a class="viewcode-back" href="../../../_autosummary/despasito.input_output.readwrite_input.process_bead_data.html#despasito.input_output.readwrite_input.process_bead_data">[docs]</a><span class="k">def</span> <span class="nf">process_bead_data</span><span class="p">(</span><span class="n">bead_data</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process system information from input file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bead_data : list[list]</span>
<span class="sd">        List of strings and dictionaries from .json file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xi : list[float]</span>
<span class="sd">        Mole fraction of component, only relevant for parameter fitting</span>
<span class="sd">    beads : list[str]</span>
<span class="sd">        List of unique bead names used among components</span>
<span class="sd">    nui : numpy.ndarray</span>
<span class="sd">        Array of number of components by number of bead types. Defines the number of each type of group in each component.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1">#find list of unique beads</span>
    <span class="n">beads</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bead_data</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bead_data</span><span class="p">)):</span>
        <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bead_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bead_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])):</span>
            <span class="k">if</span> <span class="n">bead_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">beads</span><span class="p">:</span>
                <span class="n">beads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bead_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">beads</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="n">nui</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">beads</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bead_data</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bead_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">beads</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">bead_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">beads</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">bead_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">xi</span><span class="p">,</span> <span class="n">beads</span><span class="p">,</span> <span class="n">nui</span></div>

<span class="c1">######################################################################</span>
<span class="c1">#                                                                    #</span>
<span class="c1">#                  Parameter Fitting Data                            #</span>
<span class="c1">#                                                                    #</span>
<span class="c1">######################################################################</span>
<div class="viewcode-block" id="process_param_fit_inputs"><a class="viewcode-back" href="../../../_autosummary/despasito.input_output.readwrite_input.process_param_fit_inputs.html#despasito.input_output.readwrite_input.process_param_fit_inputs">[docs]</a><span class="k">def</span> <span class="nf">process_param_fit_inputs</span><span class="p">(</span><span class="n">thermo_dict</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process parameter fitting information and data formatting according to input file instructions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    thermo_dict : dict</span>
<span class="sd">        Dictionary of instructions for thermodynamic calculations or parameter fitting. This dictionary is directly from the input file.</span>

<span class="sd">        - opt_params (dict) - Parameters used in basin fitting algorithm</span>

<span class="sd">            - fit_bead (str) - Name of bead whose parameters are being fit, should be in bead list of beadconfig</span>
<span class="sd">            - fit_params (list[str]) - This list of contains the name of the parameter being fit (e.g. epsilon). See EOS mentation for supported parameter names. Cross interaction parameter names should be composed of parameter name and the other bead type, separated by an underscore (e.g. epsilon_CO2).</span>
<span class="sd">            - *_bounds (list[float]), Optional - This list contains the minimum and maximum of the parameter from a parameter listed in fit_params, represented in place of the asterisk. See input file instructions for more information.</span>
<span class="sd">            - *name* (dict) - Dictionary of a data set that the parameters are fit to. Each dictionary is added to the exp_data dictionary before being passed to the fitting algorithm. Each *name* is used as the key in exp_data. *name* is an arbitrary string used to identify the data set and used later in reporting objective function values during the fitting process. See data type objects for more details.</span>

<span class="sd">        - datatype (str) - One of the supported data type objects to fit parameters</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_thermo_dict : dict</span>
<span class="sd">        Dictionary of instructions for thermodynamic calculations or parameter fitting. This dictionary is reformatted and includes imported data. Dictionary values below are altered before being passed on, all other key and value sets are blindly passed on.</span>

<span class="sd">        - opt_params (dict) - Parameters used in basin fitting algorithm</span>

<span class="sd">            - fit_bead (str) - Name of bead whose parameters are being fit, should be in bead list of beadconfig</span>
<span class="sd">            - fit_params (list[str]) - This list of contains the name of the parameter being fit (e.g. epsilon). See EOS mentation for supported parameter names. Cross interaction parameter names should be composed of parameter name and the other bead type, separated by an underscore (e.g. epsilon_CO2).</span>
<span class="sd">            - bounds (numpy.ndarray) - List of lists of length two, of length equal to fit_params. If no bounds were given then the default parameter boundaries are [0,1e+4], else bounds given as *_bounds in input file are used.</span>

<span class="sd">        - exp_data (dict) - This dictionary is made up of a dictionary for each data set that the parameters are fit to. Each key is an arbitrary string used to identify the data set and used later in reporting objective function values during the fitting process. See data type objects for more details.</span>

<span class="sd">            - name (str) - One of the supported data type objects to fit parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1"># Initial new dictionary that will have dictionary for extracted data</span>
    <span class="n">new_thermo_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;exp_data&quot;</span><span class="p">:{}}</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">thermo_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;opt_params&quot;</span><span class="p">:</span> 
            <span class="n">new_opt_params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">keys_del</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">new_opt_params</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e+4</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;fit_params&quot;</span><span class="p">]))]</span>
            <span class="k">for</span> <span class="n">key2</span><span class="p">,</span> <span class="n">value2</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key2</span> <span class="o">==</span> <span class="s2">&quot;fit_bead&quot;</span><span class="p">:</span>
                    <span class="n">new_opt_params</span><span class="p">[</span><span class="s2">&quot;fit_bead&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;fit_bead&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">key2</span> <span class="o">==</span> <span class="s2">&quot;fit_params&quot;</span><span class="p">:</span>
                    <span class="n">new_opt_params</span><span class="p">[</span><span class="s2">&quot;fit_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;fit_params&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s2">&quot;bounds&quot;</span> <span class="ow">in</span> <span class="n">key2</span><span class="p">:</span>
                    <span class="n">tmp</span>  <span class="o">=</span> <span class="n">key2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_bounds&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;fit_params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
                    <span class="n">new_opt_params</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">value2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">keys_del</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">keys_del</span><span class="p">:</span>
                <span class="n">value</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key2</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
               <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The opt_params keys: </span><span class="si">{}</span><span class="s2">, were not used.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">()))))</span>
            <span class="n">new_thermo_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_opt_params</span>

        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="s2">&quot;datatype&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">new_thermo_dict</span><span class="p">[</span><span class="s2">&quot;exp_data&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">process_exp_data</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_thermo_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># Move opt_params values to thermo_dict</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">,</span><span class="s2">&quot;minimizer_dict&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">new_thermo_dict</span><span class="p">[</span><span class="s2">&quot;opt_params&quot;</span><span class="p">]:</span>
            <span class="n">new_thermo_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_thermo_dict</span><span class="p">[</span><span class="s2">&quot;opt_params&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
            <span class="n">new_thermo_dict</span><span class="p">[</span><span class="s2">&quot;opt_params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">test1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;exp_data&quot;</span><span class="p">,</span><span class="s2">&quot;opt_params&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">new_thermo_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">test2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;fit_bead&quot;</span><span class="p">,</span><span class="s2">&quot;fit_params&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">new_thermo_dict</span><span class="p">[</span><span class="s2">&quot;opt_params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">test1</span><span class="p">,</span><span class="n">test2</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;An exp_data and opt_params dictionary with, fit_beads and fit_params must be given&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_thermo_dict</span></div>

<span class="c1">######################################################################</span>
<span class="c1">#                                                                    #</span>
<span class="c1">#                  Process Experimental Data                         #</span>
<span class="c1">#                                                                    #</span>
<span class="c1">######################################################################</span>
<div class="viewcode-block" id="process_exp_data"><a class="viewcode-back" href="../../../_autosummary/despasito.input_output.readwrite_input.process_exp_data.html#despasito.input_output.readwrite_input.process_exp_data">[docs]</a><span class="k">def</span> <span class="nf">process_exp_data</span><span class="p">(</span><span class="n">exp_data_dict</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process raw experimental data dictionary into one that can be used by the parameter fitting module. Note that there should be one dictionary per data set. All data is extracted from data files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    exp_data : dict</span>
<span class="sd">       This dictionary is made up of a dictionary for each data set that the parameters are fit to. Each key is an arbitrary string used to identify the data set and used later in reporting objective function values during the fitting process. See data type objects for more details. Dictionary values below are altered before being passed on, all other key and value sets are blindly passed on.</span>

<span class="sd">       - datatype (str) - One of the supported data type objects to fit parameters</span>
<span class="sd">       - file (str) - File name in current working directory, or path to desired experimental data. See experimental data page for examples of acceptable format.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    exp_data : dict</span>
<span class="sd">        Reformatted dictionary of experimental data. This dictionary is made up of a dictionary for each data set that the parameters are fit to. Each key is an arbitrary string used to identify the data set and used later in reporting objective function values during the fitting process. See data type objects for more details. Dictionary values below are altered from input dictionary, all other key and value sets are blindly passed on, or extracted from data file with process_exp_data_file function.</span>

<span class="sd">        - name (str) - One of the supported data type objects to fit parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">exp_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">exp_data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;datatype&quot;</span><span class="p">:</span>
            <span class="n">exp_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="n">file_dict</span> <span class="o">=</span> <span class="n">process_exp_data_file</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">exp_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">file_dict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exp_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">return</span> <span class="n">exp_data</span></div>

<span class="c1">######################################################################</span>
<span class="c1">#                                                                    #</span>
<span class="c1">#                  Process Experimental Data                         #</span>
<span class="c1">#                                                                    #</span>
<span class="c1">######################################################################</span>
<div class="viewcode-block" id="process_exp_data_file"><a class="viewcode-back" href="../../../_autosummary/despasito.input_output.readwrite_input.process_exp_data_file.html#despasito.input_output.readwrite_input.process_exp_data_file">[docs]</a><span class="k">def</span> <span class="nf">process_exp_data_file</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Import data file and convert columns into dictionary entries, where the headers are the dictionary keys. The top line is skipped, and column headers are the second line. Note that column headers should be thermo properties (e.g. T, P, x1, x2, y1, y2) without suffixes. Mole fractions x1, x2, ... should be in the same order as in the beadconfig line of the input file. No mole fractions should be left out.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : str</span>
<span class="sd">        File name or path to experimental data file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    file_dict : dict</span>
<span class="sd">        Dictionary of experimental data from file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">skip_header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">file_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">}</span>
    
    <span class="c1"># Sort through properties</span>
    <span class="n">key_del</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span> <span class="o">=</span> <span class="p">[[],[],[]]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">file_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
       <span class="k">if</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
           <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

       <span class="c1"># Assuming mole fractions are listed starting at x1 and continue in order</span>
       <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">):</span> 
           <span class="n">xi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
       <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">):</span>
           <span class="n">yi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
       <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">):</span>
           <span class="n">zi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
       <span class="k">else</span><span class="p">:</span>
           <span class="k">continue</span>
       <span class="n">key_del</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_del</span><span class="p">:</span>
        <span class="n">file_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xi</span><span class="p">:</span> <span class="n">file_dict</span><span class="p">[</span><span class="s2">&quot;xi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xi</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="k">if</span> <span class="n">yi</span><span class="p">:</span> <span class="n">file_dict</span><span class="p">[</span><span class="s2">&quot;yi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yi</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="k">if</span> <span class="n">zi</span><span class="p">:</span> <span class="n">file_dict</span><span class="p">[</span><span class="s2">&quot;zi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zi</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">file_dict</span></div>

<span class="c1">######################################################################</span>
<span class="c1">#                                                                    #</span>
<span class="c1">#                  Write Thermodynamic Ouput                         #</span>
<span class="c1">#                                                                    #</span>
<span class="c1">######################################################################</span>
<div class="viewcode-block" id="writeout_dict"><a class="viewcode-back" href="../../../_autosummary/despasito.input_output.readwrite_input.writeout_dict.html#despasito.input_output.readwrite_input.writeout_dict">[docs]</a><span class="k">def</span> <span class="nf">writeout_dict</span><span class="p">(</span><span class="n">output_dict</span><span class="p">,</span><span class="n">calctype</span><span class="p">,</span><span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;thermo_output.txt&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Import dictionary of both input and output data to produce a file. A line in the top clarifies the calculation type done.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    output_dict : dict</span>
<span class="sd">        Dictionary of given and calculated information from thermodynamic module</span>
<span class="sd">    output_file : str, Optional, default: thermo_output.txt</span>
<span class="sd">        Name of output file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    File of data saved to current directory</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Define units</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;T&quot;</span><span class="p">:</span><span class="s2">&quot;K&quot;</span><span class="p">,</span><span class="s2">&quot;P&quot;</span><span class="p">:</span><span class="s2">&quot;Pa&quot;</span><span class="p">,</span><span class="s2">&quot;Psat&quot;</span><span class="p">:</span><span class="s2">&quot;Pa&quot;</span><span class="p">,</span><span class="s2">&quot;rhol&quot;</span><span class="p">:</span><span class="s2">&quot;mol/m^3&quot;</span><span class="p">,</span><span class="s2">&quot;rhov&quot;</span><span class="p">:</span><span class="s2">&quot;mol/m^3&quot;</span><span class="p">}</span>

    <span class="c1"># Make comment line</span>
    <span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;# This data was generated in DESPASITO using the thermodynamic calculation: &quot;</span><span class="o">+</span><span class="n">calctype</span>
    
    <span class="c1"># Make results matrix</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">output_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">tmp_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_matrix</span><span class="p">)):</span>
                <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># Make header line</span>
    <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot; [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{}{}</span><span class="s2">,&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">unit</span><span class="p">)</span>

    <span class="c1"># Write to file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">comment</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">matrix</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">,&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
            



</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Jennifer A Clark. Project structure based on the Computational Molecular Science Python Cookiecutter version 1.0

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>