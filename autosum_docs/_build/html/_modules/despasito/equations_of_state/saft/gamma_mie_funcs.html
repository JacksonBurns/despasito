

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>despasito.equations_of_state.saft.gamma_mie_funcs &mdash; DESPASITO  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> DESPASITO
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api.html">API Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../input_output.html">Input/Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../eos.html">Equations of State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../thermo.html">Thermodynamic Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fitparams.html">Parametrization</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">DESPASITO</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../equations_of_state.html">despasito.equations_of_state</a> &raquo;</li>
        
      <li>despasito.equations_of_state.saft.gamma_mie_funcs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for despasito.equations_of_state.saft.gamma_mie_funcs</h1><div class="highlight"><pre>
<span></span><span class="c1"># -- coding: utf8 --</span>

<span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Routines for calculating the Helmholtz energy for the SAFT-gamma equation of state.</span>
<span class="sd">    Equations referenced in this code are from V. Papaioannou et al J. Chem. Phys. 140 054107 2014</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span> <span class="c1"># NoteHere</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">misc</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">integrate</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">spo</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">solv_assoc</span>

<span class="k">if</span> <span class="s1">&#39;NUMBA_DISABLE_JIT&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">disable_jit</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;NUMBA_DISABLE_JIT&#39;</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">jit_stat</span>
    <span class="n">disable_jit</span> <span class="o">=</span> <span class="n">jit_stat</span><span class="o">.</span><span class="n">disable_jit</span>

<span class="k">if</span> <span class="n">disable_jit</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.nojit_exts</span> <span class="k">import</span> <span class="n">calc_a1s</span>
    <span class="c1">#uncomment line below for cython extensions:</span>
    <span class="c1">#from .c_exts import calc_a1s</span>
    <span class="c1">#we need to add another command-line arg to replace this hackish approach</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.jit_exts</span> <span class="k">import</span> <span class="n">calc_a1s</span><span class="p">,</span> <span class="n">calc_Xika</span>

<span class="c1">############################################################</span>
<span class="c1">#                                                          #</span>
<span class="c1">#                 A Ideal Contribution                     #</span>
<span class="c1">#                                                          #</span>
<span class="c1">############################################################</span>

<div class="viewcode-block" id="calc_Aideal"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_Aideal.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_Aideal">[docs]</a><span class="k">def</span> <span class="nf">calc_Aideal</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">massi</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Return a vector of ideal contribution of Helmholtz energy.</span>
<span class="sd">    :math:`\frac{A^{ideal}}{N k_{B} T}`</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xi : numpy.ndarray</span>
<span class="sd">        Mole fraction of each component, sum(xi) should equal 1.0</span>
<span class="sd">    rho : numpy.ndarray</span>
<span class="sd">        Number density of system [molecules/m^3]</span>
<span class="sd">    massi : numpy.ndarray</span>
<span class="sd">        Mass for each component [kg/mol]</span>
<span class="sd">    T : float</span>
<span class="sd">        Temperature of the system [K]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Aideal : nd.array</span>
<span class="sd">        Helmholtz energy of ideal gas for each density given.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rho</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nan was given as a value of density, rho&quot;</span><span class="p">)</span> 
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Value of nan for density input into Aideal&quot;</span><span class="p">)</span>

    <span class="c1"># Check for mole fractions of zero and remove those components</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-32</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xi_tmp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">massi_tmp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">:</span>
            <span class="n">xi_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">massi_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">massi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">xi_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xi_tmp</span><span class="p">)</span>
    <span class="n">massi_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">massi_tmp</span><span class="p">)</span>

    <span class="c1"># rhoi: (number of components,number of densities) number density of each component for each density</span>
    <span class="n">rhoi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">xi_tmp</span><span class="p">)</span>
    <span class="n">Lambda3</span> <span class="o">=</span> <span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">h</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">massi_tmp</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">Nav</span><span class="p">)</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">kb</span> <span class="o">*</span> <span class="n">T</span><span class="p">))</span><span class="o">**</span><span class="mi">3</span>
    <span class="n">Aideal_tmp</span> <span class="o">=</span> <span class="n">rhoi</span><span class="o">*</span><span class="n">Lambda3</span>

<span class="c1">#    if not any(np.sum(xi_tmp * np.log(Aideal_tmp), axis=1)):</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xi_tmp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Aideal_tmp</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Aideal has values of zero when taking the log. All mole fraction values should be nonzero. Mole fraction: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xi_tmp</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Aideal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xi_tmp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Aideal_tmp</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>

    <span class="k">return</span> <span class="n">Aideal</span></div>

<span class="c1">############################################################</span>
<span class="c1">#                                                          #</span>
<span class="c1">#            A Monomer (Group) Contribution                #</span>
<span class="c1">#                                                          #</span>
<span class="c1">############################################################</span>

<span class="k">def</span> <span class="nf">_dkk_int</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Ce_kT</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">l_r</span><span class="p">,</span> <span class="n">l_a</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Return integrand used to calculate the hard sphere diameter, :math:`d_{k,k}` of a group k. See eq. 10.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r : numpy.ndarray</span>
<span class="sd">        Bead distance between zero and :math:`sigma_{k,k}` [Å]</span>
<span class="sd">    Ce_kT : float</span>
<span class="sd">        :math:`C \epsilon_{k,k}/(k_B T)`, Mie prefactor scaled by kT</span>
<span class="sd">    sigma : float</span>
<span class="sd">        :math:`\sigma_{k,k}`, Size parameter [Å] (or same units as r)</span>
<span class="sd">    l_r : float</span>
<span class="sd">        :math:`\lambda^{r}_{k,k}`, Exponent of repulsive term between groups of type k</span>
<span class="sd">    l_a : float</span>
<span class="sd">        :math:`\lambda^{r}_{k,k}`, Exponent of repulsive term between groups of type k</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dkk_int_tmp : numpy.ndarray</span>
<span class="sd">        Integrand used to calculate the hard sphere diameter</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">dkk_int_tmp</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Ce_kT</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">sigma</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="n">l_r</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">sigma</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="n">l_a</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">dkk_int_tmp</span>


<div class="viewcode-block" id="calc_dkk"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_dkk.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_dkk">[docs]</a><span class="k">def</span> <span class="nf">calc_dkk</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">l_r</span><span class="p">,</span> <span class="n">l_a</span><span class="o">=</span><span class="mf">6.0</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Calculates hard sphere diameter of a group, :math:`d_{k,k}`. Defined in eq. 10.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    epsilon : float</span>
<span class="sd">        :math:`\epsilon_{k,k}/k_B`, Energy well depth scaled by Boltzmann constant [K]</span>
<span class="sd">    sigma : float</span>
<span class="sd">        :math:`\sigma_{k,k}`, Size parameter [Å] (or same units as r)</span>
<span class="sd">    T : float</span>
<span class="sd">        Temperature of the system [K]</span>
<span class="sd">    l_r : float</span>
<span class="sd">        :math:`\lambda^{r}_{k,k}`, Exponent of repulsive term between groups of type k</span>
<span class="sd">    l_a : float, Optional, default: 6.0</span>
<span class="sd">        :math:`\lambda^{r}_{k,k}`, Exponent of repulsive term between groups of type k</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dkk : float</span>
<span class="sd">        Hard sphere diameter of a group [Å] </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">Ce_kT</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">l_r</span><span class="p">,</span> <span class="n">l_a</span><span class="p">)</span> <span class="o">*</span> <span class="n">epsilon</span> <span class="o">/</span> <span class="n">T</span>
    <span class="c1"># calculate integral of dkk_int from 0.0 to sigma</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">_dkk_int</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Ce_kT</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">l_r</span><span class="p">,</span> <span class="n">l_a</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="mf">1.0e-16</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1.0e-16</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="C"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.C.html#despasito.equations_of_state.saft.gamma_mie_funcs.C">[docs]</a><span class="k">def</span> <span class="nf">C</span><span class="p">(</span><span class="n">l_r</span><span class="p">,</span> <span class="n">l_a</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Calculations C, the Mie potential prefactor, defined in eq. 2</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    l_a : float</span>
<span class="sd">        Mie potential attractive exponent</span>
<span class="sd">    l_r : float</span>
<span class="sd">        Mie potential attractive exponent</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    C : float</span>
<span class="sd">        Mie potential prefactor</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">l_r</span> <span class="o">/</span> <span class="p">(</span><span class="n">l_r</span> <span class="o">-</span> <span class="n">l_a</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">l_r</span> <span class="o">/</span> <span class="n">l_a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">l_a</span> <span class="o">/</span> <span class="p">(</span><span class="n">l_r</span> <span class="o">-</span> <span class="n">l_a</span><span class="p">))</span></div>

<div class="viewcode-block" id="calc_interaction_matrices"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_interaction_matrices.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_interaction_matrices">[docs]</a><span class="k">def</span> <span class="nf">calc_interaction_matrices</span><span class="p">(</span><span class="n">beads</span><span class="p">,</span> <span class="n">beadlibrary</span><span class="p">,</span> <span class="n">crosslibrary</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes matrices of cross interaction parameters epsilonkl, sigmakl, l_akl, l_rkl (attractive and repulsive exponents), Ckl</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    beads : list[str]</span>
<span class="sd">        List of unique bead names used among components</span>
<span class="sd">    beadlibrary : dict</span>
<span class="sd">        A dictionary where bead names are the keys to access EOS self interaction parameters:</span>

<span class="sd">        * epsilon: :math:`\epsilon_{k,k}/k_B`, Energy well depth scaled by Boltzmann constant</span>
<span class="sd">        * sigma: :math:`\sigma_{k,k}`, Size parameter [m]</span>
<span class="sd">        * mass: Bead mass [kg/mol]</span>
<span class="sd">        * l_r: :math:`\lambda^{r}_{k,k}`, Exponent of repulsive term between groups of type k</span>
<span class="sd">        * l_a: :math:`\lambda^{a}_{k,k}`, Exponent of attractive term between groups of type k</span>
<span class="sd">        * Sk: :math:`S_{k}`, Shape parameter of group k</span>
<span class="sd">        * Vks: :math:`V_{k,s}`, Number of groups, k, in component</span>
<span class="sd">    crosslibrary : dict, Optional, default: {}</span>
<span class="sd">        Optional library of bead cross interaction parameters. As many or as few of the desired parameters may be defined for whichever group combinations are desired. If this matrix isn&#39;t provided, the SAFT mixing rules are used.</span>

<span class="sd">        * epsilon: :math:`\epsilon_{k,l}/k_B`, Energy parameter scaled by Boltzmann Constant</span>
<span class="sd">        * l_r: :math:`\lambda^{r}_{k,l}`, Exponent of repulsive term between groups of type k and l</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    epsilonkl : numpy.ndarray</span>
<span class="sd">        Matrix of well depths for groups (k,l)</span>
<span class="sd">    sigmakl : numpy.ndarray</span>
<span class="sd">        Matrix of mie diameter for groups (k,l)</span>
<span class="sd">    l_akl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential attractive exponents for k,l groups</span>
<span class="sd">    l_rkl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential attractive exponents for k,l groups</span>
<span class="sd">    Ckl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential prefactors for k,l groups</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">nbeads</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">beads</span><span class="p">)</span>
    <span class="n">sigmakl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbeads</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">))</span>
    <span class="n">l_rkl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbeads</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">))</span>
    <span class="n">l_akl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbeads</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">))</span>
    <span class="n">epsilonkl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbeads</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">))</span>

    <span class="c1"># compute default interaction parameters for beads</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbeads</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbeads</span><span class="p">):</span>
            <span class="n">sigmakl</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">l</span><span class="p">]][</span><span class="s2">&quot;sigma&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">l_rkl</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s2">&quot;l_r&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">l</span><span class="p">]][</span><span class="s2">&quot;l_r&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">))</span>
            <span class="n">l_akl</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s2">&quot;l_a&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">l</span><span class="p">]][</span><span class="s2">&quot;l_a&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">))</span>
            <span class="n">epsilonkl</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s2">&quot;epsilon&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">l</span><span class="p">]][</span><span class="s2">&quot;epsilon&quot;</span><span class="p">])</span> <span class="o">*</span> \
                              <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">l</span><span class="p">]][</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                                          <span class="n">sigmakl</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
    <span class="c1"># testing if crosslibrary is empty ie not specified</span>
    <span class="k">if</span> <span class="n">crosslibrary</span><span class="p">:</span>
        <span class="c1"># find any cross terms in the cross term library</span>
        <span class="n">crosslist</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">beadname</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">beads</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">beadname</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">crosslibrary</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">beadname2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">beads</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">beadname2</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">crosslibrary</span><span class="p">[</span><span class="n">beadname</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">crosslist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">crosslist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">beads</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">crosslibrary</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">beads</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">crosslibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">a</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="s2">&quot;epsilon&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">crosslibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">a</span><span class="p">]][</span><span class="n">beads</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">epsilonkl</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">crosslibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">a</span><span class="p">]][</span><span class="n">beads</span><span class="p">[</span><span class="n">b</span><span class="p">]][</span><span class="s2">&quot;epsilon&quot;</span><span class="p">]</span>
                        <span class="n">epsilonkl</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">epsilonkl</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;l_r&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">crosslibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">a</span><span class="p">]][</span><span class="n">beads</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">l_rkl</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">crosslibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">a</span><span class="p">]][</span><span class="n">beads</span><span class="p">[</span><span class="n">b</span><span class="p">]][</span><span class="s2">&quot;l_r&quot;</span><span class="p">]</span>
                        <span class="n">l_rkl</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">l_rkl</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>

    <span class="n">Ckl</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">l_rkl</span><span class="p">,</span> <span class="n">l_akl</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">sigmakl</span><span class="p">,</span> <span class="n">l_akl</span><span class="p">,</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">Ckl</span></div>

<div class="viewcode-block" id="calc_composition_dependent_variables"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_composition_dependent_variables.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_composition_dependent_variables">[docs]</a><span class="k">def</span> <span class="nf">calc_composition_dependent_variables</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">beads</span><span class="p">,</span> <span class="n">beadlibrary</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Return conversion factor from molecular number density, :math:`\rho`, to segment (i.e. group) number density, :math:`\rho_S`. Shown in eq. 13</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xi : numpy.ndarray</span>
<span class="sd">        Mole fraction of each component, sum(xi) should equal 1.0</span>
<span class="sd">    nui : numpy.array</span>
<span class="sd">        :math:`\nu_{i,k}/k_B`, Array of number of components by number of bead types. Defines the number of each type of group in each component. </span>
<span class="sd">        Defined for eq. 11. Note that indices are flipped from definition in reference.</span>
<span class="sd">    beads : list[str]</span>
<span class="sd">        List of unique bead names used among components</span>
<span class="sd">    beadlibrary : dict</span>
<span class="sd">        A dictionary where bead names are the keys to access EOS self interaction parameters:</span>

<span class="sd">        * epsilon: :math:`\epsilon_{k,k}/k_B`, Energy well depth scaled by Boltzmann constant</span>
<span class="sd">        * sigma: :math:`\sigma_{k,k}`, Size parameter [m]</span>
<span class="sd">        * mass: Bead mass [kg/mol]</span>
<span class="sd">        * l_r: :math:`\lambda^{r}_{k,k}`, Exponent of repulsive term between groups of type k</span>
<span class="sd">        * l_a: :math:`\lambda^{a}_{k,k}`, Exponent of attractive term between groups of type k</span>
<span class="sd">        * Sk: :math:`S_{k}`, Shape parameter of group k</span>
<span class="sd">        * Vks: :math:`V_{k,s}`, Number of groups, k, in component</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Cmol2seg : float</span>
<span class="sd">        Conversion factor from from molecular number density, :math:`\rho`, to segment (i.e. group) number density, :math:`\rho_S`. Shown in eq. 13</span>
<span class="sd">    xsk : numpy.ndarray</span>
<span class="sd">        Mole fraction of each bead (i.e. segment or group), sum(xsk) should equal 1.0</span>
<span class="sd">    xskl : numpy.ndarray</span>
<span class="sd">        Matrix of mole fractions of bead (i.e. segment or group) k multiplied by bead l</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1"># compute Conversion factor</span>
    <span class="n">Cmol2seg</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">beads</span><span class="p">)):</span>
            <span class="n">Cmol2seg</span> <span class="o">+=</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="s2">&quot;Vks&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="s2">&quot;Sk&quot;</span><span class="p">]</span>

    <span class="c1"># initialize variables and arrays</span>
    <span class="n">nbeads</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">beads</span><span class="p">)</span>
    <span class="n">xsk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbeads</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="c1"># compute xsk</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbeads</span><span class="p">):</span>
        <span class="n">xsk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xi</span> <span class="o">*</span> <span class="n">nui</span><span class="p">[:,</span> <span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s2">&quot;Vks&quot;</span><span class="p">]</span> <span class="o">*</span> \
                 <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s2">&quot;Sk&quot;</span><span class="p">]</span>
    <span class="n">xsk</span> <span class="o">/=</span> <span class="n">Cmol2seg</span>

    <span class="c1"># calculate  xskl matrix</span>
    <span class="n">xskl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbeads</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbeads</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbeads</span><span class="p">):</span>
            <span class="n">xskl</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">xsk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">xsk</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">xsk</span><span class="p">,</span> <span class="n">xskl</span></div>

<div class="viewcode-block" id="calc_hard_sphere_matricies"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_hard_sphere_matricies.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_hard_sphere_matricies">[docs]</a><span class="k">def</span> <span class="nf">calc_hard_sphere_matricies</span><span class="p">(</span><span class="n">beads</span><span class="p">,</span> <span class="n">beadlibrary</span><span class="p">,</span> <span class="n">sigmakl</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes matrix of hard sphere interaction parameters dkk, dkl, and x0kl</span>
<span class="sd">    This does not include function specific or association terms</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    beads : list[str]</span>
<span class="sd">        List of unique bead names used among components</span>
<span class="sd">    beadlibrary : dict</span>
<span class="sd">        A dictionary where bead names are the keys to access EOS self interaction parameters:</span>

<span class="sd">        * epsilon: :math:`\epsilon_{k,k}/k_B`, Energy well depth scaled by Boltzmann constant</span>
<span class="sd">        * sigma: :math:`\sigma_{k,k}`, Size parameter [m]</span>
<span class="sd">        * mass: Bead mass [kg/mol]</span>
<span class="sd">        * l_r: :math:`\lambda^{r}_{k,k}`, Exponent of repulsive term between groups of type k</span>
<span class="sd">        * l_a: :math:`\lambda^{a}_{k,k}`, Exponent of attractive term between groups of type k</span>
<span class="sd">        * Sk: :math:`S_{k}`, Shape parameter of group k</span>
<span class="sd">        * Vks: :math:`V_{k,s}`, Number of groups, k, in component</span>
<span class="sd">    sigmakl : numpy.ndarray</span>
<span class="sd">        Matrix of mie diameter for groups (k,l)</span>
<span class="sd">    T : float</span>
<span class="sd">        Temperature of the system [K]</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dkk : numpy.ndarray</span>
<span class="sd">        Array of hard sphere diameters for each group</span>
<span class="sd">    dkl : numpy.ndarray</span>
<span class="sd">        Matrix of hard sphere diameters for groups (k,l)</span>
<span class="sd">    x0kl : numpy.ndarray</span>
<span class="sd">        Matrix of sigmakl/dkl, sigmakl is the mie radius for groups (k,l)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">nbeads</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">beads</span><span class="p">)</span>
    <span class="n">dkk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">beads</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">beads</span><span class="p">)):</span>
        <span class="n">dkk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_dkk</span><span class="p">(</span><span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;epsilon&quot;</span><span class="p">],</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;sigma&quot;</span><span class="p">],</span> <span class="n">T</span><span class="p">,</span>
                          <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;l_r&quot;</span><span class="p">],</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;l_a&quot;</span><span class="p">])</span>
    <span class="n">dkl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbeads</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbeads</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbeads</span><span class="p">):</span>
            <span class="n">dkl</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dkk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">dkk</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>

    <span class="n">x0kl</span> <span class="o">=</span> <span class="n">sigmakl</span> <span class="o">/</span> <span class="n">dkl</span>

    <span class="k">return</span> <span class="n">dkk</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">x0kl</span></div>

<div class="viewcode-block" id="calc_Bkl"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_Bkl.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_Bkl">[docs]</a><span class="k">def</span> <span class="nf">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">l_kl</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">x0kl</span><span class="p">,</span> <span class="n">zetax</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Return Bkl(rho*Cmol2seg,l_kl) in K as defined in eq. 20, used in the calculation of :math:`A_1` the first order term of the perturbation expansion corresponding to the mean-attractive energy.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rho : numpy.ndarray</span>
<span class="sd">        Number density of system [molecules/m^3]</span>
<span class="sd">    l_kl : numpy.ndarray</span>
<span class="sd">        :math:`\lambda_{k,l}` Matrix of Mie potential exponents for k,l groups</span>
<span class="sd">    Cmol2seg : float</span>
<span class="sd">        Conversion factor from from molecular number density, :math:`\rho`, to segment (i.e. group) number density, :math:`\rho_S`. Shown in eq. 13</span>
<span class="sd">    dkl : numpy.ndarray</span>
<span class="sd">        Matrix of hardsphere diameters for groups (k,l)</span>
<span class="sd">    epsilonkl : numpy.ndarray</span>
<span class="sd">        Matrix of well depths for groups (k,l)</span>
<span class="sd">    x0kl : numpy.ndarray</span>
<span class="sd">        Matrix of sigmakl/dkl, ratio of Mie radius for groups scaled by hard sphere interaction (k,l)</span>
<span class="sd">    zetax : numpy.ndarray</span>
<span class="sd">        Matrix of hypothetical packing fraction based on hard sphere diameter for groups (k,l)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Bkl : numpy.ndarray</span>
<span class="sd">        Matrix used in the calculation of :math:`A_1` the first order term of the perturbation expansion corresponding to the mean-attractive energy, size is rho x l_kl.shape</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">rhos</span> <span class="o">=</span> <span class="n">Cmol2seg</span> <span class="o">*</span> <span class="n">rho</span>

    <span class="c1"># compute Ikl(l_kl), eq. 23</span>
    <span class="n">Ikl</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">x0kl</span><span class="o">**</span><span class="p">(</span><span class="mf">3.0</span> <span class="o">-</span> <span class="n">l_kl</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="n">l_kl</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">)</span>
    <span class="c1"># compute Jkl(l_kl), eq. 24</span>
    <span class="n">Jkl</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">((</span><span class="n">x0kl</span><span class="o">**</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">-</span> <span class="n">l_kl</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">l_kl</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">))</span> <span class="o">+</span> <span class="p">((</span><span class="n">x0kl</span><span class="o">**</span><span class="p">(</span><span class="mf">3.0</span> <span class="o">-</span> <span class="n">l_kl</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">l_kl</span> <span class="o">-</span> <span class="mf">4.0</span><span class="p">)))</span> <span class="o">/</span> <span class="p">((</span><span class="n">l_kl</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">l_kl</span> <span class="o">-</span> <span class="mf">4.0</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">l_kl</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># Bkl=np.zeros((np.size(rho),np.size(l_kl,axis=0),np.size(l_kl,axis=0)))</span>

        <span class="n">Bkl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk&quot;</span><span class="p">,</span> <span class="n">rhos</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">dkl</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">epsilonkl</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">zetax</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                            <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">zetax</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="n">Ikl</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk&quot;</span><span class="p">,</span> <span class="p">((</span><span class="mf">9.0</span> <span class="o">*</span> <span class="n">zetax</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">zetax</span><span class="p">))</span> <span class="o">/</span>
                                                                        <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zetax</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">))),</span> <span class="n">Jkl</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">l_kl</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Bkl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,j&quot;</span><span class="p">,</span> <span class="n">rhos</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">dkl</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">epsilonkl</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,j&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">zetax</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                            <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">zetax</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="n">Ikl</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,j&quot;</span><span class="p">,</span> <span class="p">((</span><span class="mf">9.0</span> <span class="o">*</span> <span class="n">zetax</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">zetax</span><span class="p">))</span> <span class="o">/</span>
                                                                       <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zetax</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">))),</span> <span class="n">Jkl</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Error unexpeced l_kl shape in Bkl&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Bkl</span></div>

<div class="viewcode-block" id="calc_fm"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_fm.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_fm">[docs]</a><span class="k">def</span> <span class="nf">calc_fm</span><span class="p">(</span><span class="n">alphakl</span><span class="p">,</span> <span class="n">mlist</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Calculate fm(alphakl) where a list of m values are specified in mlist eq. 39</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    alphakl : numpy.ndarray</span>
<span class="sd">        (Ngroup,Ngroup) &quot;A dimensionless form of the integrated vdW energy of the Mie potential&quot; eq. 33</span>
<span class="sd">    mlist : numpy.ndarray</span>
<span class="sd">        (number of m values) an array of integers used in the calculation of :math:`A^{mono}`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fmlist : numpy.ndarray</span>
<span class="sd">        List of coefficients used to compute the correction term for :math:`A_{2}` which is related to the fluctuations of attractive energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">nbeads</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">alphakl</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">alphakl</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">fmlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">mlist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">alphakl</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">alphakl</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">alphakl</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">fmlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">mlist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">alphakl</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Error: unexpected shape in calcfm&#39;</span><span class="p">)</span>
    <span class="n">mlist</span> <span class="o">=</span> <span class="n">mlist</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mlist</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">fmlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">constants</span><span class="o">.</span><span class="n">phimn</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">alphakl</span><span class="o">**</span><span class="n">n</span><span class="p">)</span>
        <span class="n">dum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">fmlist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
            <span class="n">dum</span> <span class="o">+=</span> <span class="n">constants</span><span class="o">.</span><span class="n">phimn</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">alphakl</span><span class="o">**</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">))</span>
        <span class="n">fmlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">dum</span>

    <span class="k">return</span> <span class="n">fmlist</span></div>

<div class="viewcode-block" id="calc_Amono"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_Amono.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_Amono">[docs]</a><span class="k">def</span> <span class="nf">calc_Amono</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">xsk</span><span class="p">,</span> <span class="n">xskl</span><span class="p">,</span> <span class="n">dkk</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">sigmakl</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">l_akl</span><span class="p">,</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">Ckl</span><span class="p">,</span> <span class="n">x0kl</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Outputs :math:`A^{HS}, A_1, A_2`, and :math:`A_3` (number of densities) :math:`A^{mono.}` components as well as some related quantities. Note these quantities are normalized by NkbT. Eta is really zeta</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rho : numpy.ndarray</span>
<span class="sd">        Number density of system [molecules/m^3]</span>
<span class="sd">    xi : numpy.ndarray</span>
<span class="sd">        Mole fraction of each component, sum(xi) should equal 1.0</span>
<span class="sd">    nui : numpy.array</span>
<span class="sd">        :math:`\nu_{i,k}/k_B`, Array of number of components by number of bead types. Defines the number of each type of group in each component. </span>
<span class="sd">    Cmol2seg : float</span>
<span class="sd">        Conversion factor from from molecular number density, :math:`\rho`, to segment (i.e. group) number density, :math:`\rho_S`. Shown in eq. 13</span>
<span class="sd">    xsk : numpy.ndarray</span>
<span class="sd">        Mole fraction of each bead (i.e. segment or group), sum(xsk) should equal 1.0</span>
<span class="sd">    xskl : numpy.ndarray</span>
<span class="sd">        Matrix of mole fractions of bead (i.e. segment or group) k multiplied by bead l</span>
<span class="sd">    dkk : numpy.ndarray</span>
<span class="sd">        Array of hard sphere diameters for each group</span>
<span class="sd">    T : float</span>
<span class="sd">        Temperature of the system [K]</span>
<span class="sd">    epsilonkl : numpy.ndarray</span>
<span class="sd">        Matrix of well depths for groups (k,l)</span>
<span class="sd">    sigmakl : numpy.ndarray</span>
<span class="sd">        Matrix of mie diameter for groups (k,l)</span>
<span class="sd">    dkl : numpy.ndarray</span>
<span class="sd">        Matrix of hardsphere diameters for groups (k,l)</span>
<span class="sd">    l_akl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential attractive exponents for k,l groups</span>
<span class="sd">    l_rkl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential attractive exponents for k,l groups</span>
<span class="sd">    Ckl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential prefactors for k,l groups</span>
<span class="sd">    x0kl : numpy.ndarray</span>
<span class="sd">        Matrix of sigmakl/dkl, sigmakl is the mie radius for groups (k,l)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    AHS : numpy.ndarray</span>
<span class="sd">        Hard sphere contribution of Helmholtz energy, length of array rho</span>
<span class="sd">    A1 : numpy.ndarray</span>
<span class="sd">        Contribution of first perturbation corresponding to mean attractive energy, length of array rho</span>
<span class="sd">    A2 : numpy.ndarray</span>
<span class="sd">        Contribution of second perturbation corresponding to fluctuations mean attractive energy, length of array rho</span>
<span class="sd">    A3 : numpy.ndarray</span>
<span class="sd">        Contribution of third perturbation term of mean attractive energy, length of array rho</span>
<span class="sd">    zetax : numpy.ndarray</span>
<span class="sd">        Matrix of hypothetical packing fraction based on hard sphere diameter for groups (k,l)</span>
<span class="sd">    zetaxstar : numpy.ndarray</span>
<span class="sd">        Matrix of hypothetical packing fraction based on sigma</span>
<span class="sd">    KHS : numpy.ndarray</span>
<span class="sd">        (length of densities) isothermal compressibility of system with packing fraction zetax</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1"># initialize variables</span>
    <span class="n">nbeads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nui</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># nbeads is the number of unique groups used by any compnent</span>
    <span class="n">rhos</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">Cmol2seg</span>

    <span class="c1">##### compute AHS (eq. 16) #####</span>

    <span class="c1"># initialize variables for AHS</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>

    <span class="c1"># compute eta, eq. 14</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">eta</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhos</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xsk</span> <span class="o">*</span> <span class="p">(</span><span class="n">dkk</span><span class="o">**</span><span class="n">m</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">rho</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;rho:&quot;</span><span class="p">,</span><span class="n">rho</span><span class="p">)</span>
    <span class="c1"># compute AHS, eq. 16</span>
    <span class="n">AHS</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rho</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">eta</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="p">(((</span><span class="n">eta</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">eta</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">eta</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span>
                                   <span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">eta</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">eta</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span>
                                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]))</span> <span class="o">+</span> <span class="p">((</span><span class="n">eta</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">eta</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">eta</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>

    <span class="c1">##### compute a1kl, eq. 19 #####</span>

    <span class="c1"># calc zetax eq. 22</span>
    <span class="n">zetax</span> <span class="o">=</span> <span class="n">rhos</span> <span class="o">*</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xskl</span> <span class="o">*</span> <span class="p">(</span><span class="n">dkl</span><span class="o">**</span><span class="mi">3</span><span class="p">)))</span>

    <span class="c1"># compute components of eq. 19</span>
    <span class="n">a1kl</span> <span class="o">=</span> <span class="n">calc_a1ii</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">l_akl</span><span class="p">,</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">x0kl</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>

    <span class="c1">##### compute a2kl, eq. 30 #####</span>

    <span class="c1"># initialize variables for a2kl</span>
    <span class="c1"># a2kl = np.zeros((nbeads,nbeads))</span>
    <span class="c1"># alphakl = np.zeros((nbeads,nbeads))</span>

    <span class="c1"># compute KHS(rho), eq. 31</span>
    <span class="n">KHS</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">zetax</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">zetax</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">zetax</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">zetax</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">zetax</span><span class="o">**</span><span class="mi">4</span><span class="p">))</span>

    <span class="c1"># compute alphakl eq. 33</span>
    <span class="n">alphakl</span> <span class="o">=</span> <span class="n">Ckl</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">l_akl</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">l_rkl</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">)))</span>

    <span class="c1"># compute zetaxstar eq. 35</span>
    <span class="n">zetaxstar</span> <span class="o">=</span> <span class="n">rhos</span> <span class="o">*</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xskl</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigmakl</span><span class="o">**</span><span class="mi">3</span><span class="p">)))</span>

    <span class="c1"># compute f1, f2, and f3 for eq. 32</span>
    <span class="n">fmlist123</span> <span class="o">=</span> <span class="n">calc_fm</span><span class="p">(</span><span class="n">alphakl</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>

    <span class="n">chikl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk&quot;</span><span class="p">,</span> <span class="n">zetaxstar</span><span class="p">,</span> <span class="n">fmlist123</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk&quot;</span><span class="p">,</span> <span class="n">zetaxstar</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span> <span class="n">fmlist123</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
        <span class="s2">&quot;i,jk&quot;</span><span class="p">,</span> <span class="n">zetaxstar</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span> <span class="n">fmlist123</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">a1s_2la</span> <span class="o">=</span> <span class="n">calc_a1s</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_akl</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">dkl</span><span class="p">)</span>
    <span class="n">a1s_2lr</span> <span class="o">=</span> <span class="n">calc_a1s</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">dkl</span><span class="p">)</span>
    <span class="n">a1s_lalr</span> <span class="o">=</span> <span class="n">calc_a1s</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">l_akl</span> <span class="o">+</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">dkl</span><span class="p">)</span>
    <span class="n">B_2la</span> <span class="o">=</span> <span class="n">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_akl</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">x0kl</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>
    <span class="n">B_2lr</span> <span class="o">=</span> <span class="n">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">x0kl</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>
    <span class="n">B_lalr</span> <span class="o">=</span> <span class="n">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">l_akl</span> <span class="o">+</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">x0kl</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>

    <span class="n">a2kl</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0kl</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_akl</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">a1s_2la</span> <span class="o">+</span> <span class="n">B_2la</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">x0kl</span><span class="o">**</span><span class="p">(</span><span class="n">l_akl</span> <span class="o">+</span> <span class="n">l_rkl</span><span class="p">))</span> <span class="o">*</span>
                                                        <span class="p">(</span><span class="n">a1s_lalr</span> <span class="o">+</span> <span class="n">B_lalr</span><span class="p">))</span> <span class="o">+</span> <span class="p">((</span><span class="n">x0kl</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_rkl</span><span class="p">))</span> <span class="o">*</span>
                                                                                <span class="p">(</span><span class="n">a1s_2lr</span> <span class="o">+</span> <span class="n">B_2lr</span><span class="p">))</span>
    <span class="n">a2kl</span> <span class="o">*=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">chikl</span><span class="p">)</span> <span class="o">*</span> <span class="n">epsilonkl</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ckl</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># *(KHS/2.0)</span>
    <span class="n">a2kl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,ijk-&gt;ijk&quot;</span><span class="p">,</span> <span class="n">KHS</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">a2kl</span><span class="p">)</span>

    <span class="c1">##### compute a3kl #####</span>
    <span class="n">a3kl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbeads</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">))</span>
    <span class="n">fmlist456</span> <span class="o">=</span> <span class="n">calc_fm</span><span class="p">(</span><span class="n">alphakl</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]))</span>

    <span class="n">a3kl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk&quot;</span><span class="p">,</span> <span class="n">zetaxstar</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">epsilonkl</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">fmlist456</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk&quot;</span><span class="p">,</span> <span class="n">zetaxstar</span><span class="p">,</span> <span class="n">fmlist456</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk&quot;</span><span class="p">,</span> <span class="n">zetaxstar</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">fmlist456</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="c1"># a3kl=-(epsilonkl**3)*fmlist456[0]*zetaxstar*np.exp((fmlist456[1]*zetaxstar)+(fmlist456[2]*(zetaxstar**2)))</span>

    <span class="c1"># compute a1, a2, a3 from 18, 29, and 37 respectively</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ijk,jk-&gt;i&quot;</span><span class="p">,</span> <span class="n">a1kl</span><span class="p">,</span> <span class="n">xskl</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ijk,jk-&gt;i&quot;</span><span class="p">,</span> <span class="n">a2kl</span><span class="p">,</span> <span class="n">xskl</span><span class="p">)</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ijk,jk-&gt;i&quot;</span><span class="p">,</span> <span class="n">a3kl</span><span class="p">,</span> <span class="n">xskl</span><span class="p">)</span>

    <span class="c1"># compute A1, A2, and A3</span>
    <span class="c1"># note that a1, a2, and a3 have units of K, K^2, and K^3 respectively</span>
    <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cmol2seg</span> <span class="o">/</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">a1</span>
    <span class="n">A2</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cmol2seg</span> <span class="o">/</span> <span class="p">(</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">a2</span>
    <span class="n">A3</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cmol2seg</span> <span class="o">/</span> <span class="p">(</span><span class="n">T</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">a3</span>


    <span class="k">return</span> <span class="n">AHS</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">A3</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">zetaxstar</span><span class="p">,</span> <span class="n">KHS</span></div>

<span class="c1">############################################################</span>
<span class="c1">#                                                          #</span>
<span class="c1">#                  A Chain Contribution                    #</span>
<span class="c1">#                                                          #</span>
<span class="c1">############################################################</span>

<div class="viewcode-block" id="calc_a1ii"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_a1ii.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_a1ii">[docs]</a><span class="k">def</span> <span class="nf">calc_a1ii</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Calculate effective first-order perturbation term :math:`\bar{a}_{1,ii}` for the contribution of the monomeric interactions to the free energy per segment.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rho : numpy.ndarray</span>
<span class="sd">        Number density of system [molecules/m^3]</span>
<span class="sd">    Cmol2seg : float</span>
<span class="sd">        Conversion factor from from molecular number density, :math:`\rho`, to segment (i.e. group) number density, :math:`\rho_S`. Shown in eq. 13</span>
<span class="sd">    dii_eff : numpy.ndarray</span>
<span class="sd">        Effective hard sphere diameter of the beads (i.e. groups or segments) in component (i.e. molecule) i.</span>
<span class="sd">    l_aii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) attractive exponent in component (i.e. molecule) i.</span>
<span class="sd">    l_rii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) attractive exponent in component (i.e. molecule) i.</span>
<span class="sd">    x0ii : numpy.ndarray</span>
<span class="sd">        Matrix of sigmaii_avg/dii_eff</span>
<span class="sd">    epsilonii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) potential well depth in component (i.e. molecule) i.</span>
<span class="sd">    zetax : numpy.ndarray </span>
<span class="sd">        Matrix of hypothetical packing fraction based on hard sphere diameter for groups (k,l)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a1ii : numpy.ndarray</span>
<span class="sd">        Matrix used in the calculation of the radial distribution function of a hypothetical one-fluid Mie system.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">Cii</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">)</span>

    <span class="n">Bii_r</span> <span class="o">=</span> <span class="n">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>
    <span class="n">Bii_a</span> <span class="o">=</span> <span class="n">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>
    <span class="n">a1s_r</span> <span class="o">=</span> <span class="n">calc_a1s</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">)</span>
    <span class="n">a1s_a</span> <span class="o">=</span> <span class="n">calc_a1s</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">Cii</span> <span class="o">*</span> <span class="p">(((</span><span class="n">x0ii</span><span class="o">**</span><span class="n">l_aii_avg</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a1s_a</span> <span class="o">+</span> <span class="n">Bii_a</span><span class="p">))</span> <span class="o">-</span> <span class="p">((</span><span class="n">x0ii</span><span class="o">**</span><span class="n">l_rii_avg</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a1s_r</span> <span class="o">+</span> <span class="n">Bii_r</span><span class="p">))))</span></div>
    
<div class="viewcode-block" id="calc_da1iidrhos"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_da1iidrhos.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_da1iidrhos">[docs]</a><span class="k">def</span> <span class="nf">calc_da1iidrhos</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">stepmult</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>

    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Compute derivative of the term, :math:`\bar{a}_{1,ii}` with respect to :math:`\rho_s`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rho : numpy.ndarray</span>
<span class="sd">        Number density of system [molecules/m^3]</span>
<span class="sd">    Cmol2seg : float</span>
<span class="sd">        Conversion factor from from molecular number density, :math:`\rho`, to segment (i.e. group) number density, :math:`\rho_S`. Shown in eq. 13</span>
<span class="sd">    dii_eff : numpy.ndarray</span>
<span class="sd">        Effective hard sphere diameter of the beads (i.e. groups or segments) in component (i.e. molecule) i.</span>
<span class="sd">    l_aii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) attractive exponent in component (i.e. molecule) i.</span>
<span class="sd">    l_rii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) attractive exponent in component (i.e. molecule) i.</span>
<span class="sd">    x0ii : numpy.ndarray</span>
<span class="sd">        Matrix of sigmaii_avg/dii_eff</span>
<span class="sd">    epsilonii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) potential well depth in component (i.e. molecule) i.</span>
<span class="sd">    zetax : numpy.ndarray </span>
<span class="sd">        Matrix of hypothetical packing fraction based on hard sphere diameter for groups (k,l)</span>
<span class="sd">    stepmult : float, Optional, default: 1.0</span>
<span class="sd">        Factor, :math:`f_{step}`, used to change the step size used in derivative that is computed from the smallest representable positive number on the machine being used, where:</span>
<span class="sd">        :math:`step = f_{step} \sqrt{\epsilon_{smallest}}\rho_s`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    da1iidrhos : numpy.ndarray</span>
<span class="sd">        Derivative of term with respect to segment density</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">Cmol2seg</span> <span class="o">*</span> <span class="n">stepmult</span>
    <span class="n">a1ii_p</span> <span class="o">=</span> <span class="n">calc_a1ii</span><span class="p">(</span><span class="n">rho</span> <span class="o">+</span> <span class="n">step</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>
    <span class="n">a1ii_m</span> <span class="o">=</span> <span class="n">calc_a1ii</span><span class="p">(</span><span class="n">rho</span> <span class="o">-</span> <span class="n">step</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,i-&gt;ij&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">a1ii_p</span> <span class="o">-</span> <span class="n">a1ii_m</span><span class="p">),</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span></div>

<div class="viewcode-block" id="calc_a2ii_1pchi"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_a2ii_1pchi.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_a2ii_1pchi">[docs]</a><span class="k">def</span> <span class="nf">calc_a2ii_1pchi</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">):</span>

    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Calculate the term, :math:`\frac{\bar{a}_{2,ii}}{1+\bar{\chi}_{ii}}`, used in the calculation of the second-order term from the macroscopic compressibility approximation based on the fluctuation term of the Sutherland potential.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rho : numpy.ndarray</span>
<span class="sd">        Number density of system [molecules/m^3]</span>
<span class="sd">    Cmol2seg : float</span>
<span class="sd">        Conversion factor from from molecular number density, :math:`\rho`, to segment (i.e. group) number density, :math:`\rho_S`. Shown in eq. 13</span>
<span class="sd">    epsilonii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) potential well depth in component (i.e. molecule) i.</span>
<span class="sd">    dii_eff : numpy.ndarray</span>
<span class="sd">        Effective hard sphere diameter of the beads (i.e. groups or segments) in component (i.e. molecule) i.</span>
<span class="sd">    x0ii : numpy.ndarray</span>
<span class="sd">        Matrix of sigmaii_avg/dii_eff</span>
<span class="sd">    l_rii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) attractive exponent in component (i.e. molecule) i.</span>
<span class="sd">    l_aii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) attractive exponent in component (i.e. molecule) i.</span>
<span class="sd">    zetax : numpy.ndarray </span>
<span class="sd">        Matrix of hypothetical packing fraction based on hard sphere diameter for groups (k,l)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a2ii_1pchi : nump.ndarray</span>
<span class="sd">        Term used in the calculation of the second-order term from the macroscopic compressibility</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">KHS</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">zetax</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">zetax</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">zetax</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">zetax</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">zetax</span><span class="o">**</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">Cii</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">)</span>

    <span class="n">a1sii_2l_aii_avg</span> <span class="o">=</span> <span class="n">calc_a1s</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">)</span>
    <span class="n">a1sii_2l_rii_avg</span> <span class="o">=</span> <span class="n">calc_a1s</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">)</span>
    <span class="n">a1sii_l_rii_avgl_aii_avg</span> <span class="o">=</span> <span class="n">calc_a1s</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">l_aii_avg</span> <span class="o">+</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">)</span>

    <span class="n">Bii_2l_aii_avg</span> <span class="o">=</span> <span class="n">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>
    <span class="n">Bii_2l_rii_avg</span> <span class="o">=</span> <span class="n">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>
    <span class="n">Bii_l_aii_avgl_rii_avg</span> <span class="o">=</span> <span class="n">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">l_aii_avg</span> <span class="o">+</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>

    <span class="n">a2ii_1pchi</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">epsilonii_avg</span> <span class="o">*</span> <span class="p">(</span><span class="n">Cii</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">x0ii</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_aii_avg</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">a1sii_2l_aii_avg</span> <span class="o">+</span> <span class="n">Bii_2l_aii_avg</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">x0ii</span><span class="o">**</span><span class="p">(</span><span class="n">l_aii_avg</span> <span class="o">+</span> <span class="n">l_rii_avg</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="n">a1sii_l_rii_avgl_aii_avg</span> <span class="o">+</span> <span class="n">Bii_l_aii_avgl_rii_avg</span><span class="p">)</span> <span class="o">+</span>
 <span class="p">(</span><span class="n">x0ii</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_rii_avg</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">a1sii_2l_rii_avg</span> <span class="o">+</span> <span class="n">Bii_2l_rii_avg</span><span class="p">))</span>

    <span class="n">a2ii_1pchi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,ij-&gt;ij&quot;</span><span class="p">,</span> <span class="n">KHS</span><span class="p">,</span> <span class="n">a2ii_1pchi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a2ii_1pchi</span></div>

<div class="viewcode-block" id="calc_da2ii_1pchi_drhos"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_da2ii_1pchi_drhos.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_da2ii_1pchi_drhos">[docs]</a><span class="k">def</span> <span class="nf">calc_da2ii_1pchi_drhos</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">stepmult</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>

    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute derivative of the term, :math:`\frac{\bar{a}_{2,ii}}{1+\bar{\chi}_{ii}}` with respect to :math:`\rho_s`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rho : numpy.ndarray</span>
<span class="sd">        Number density of system [molecules/m^3]</span>
<span class="sd">    Cmol2seg : float</span>
<span class="sd">        Conversion factor from from molecular number density, :math:`\rho`, to segment (i.e. group) number density, :math:`\rho_S`. Shown in eq. 13</span>
<span class="sd">    epsilonii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) potential well depth in component (i.e. molecule) i.</span>
<span class="sd">    dii_eff : numpy.ndarray</span>
<span class="sd">        Effective hard sphere diameter of the beads (i.e. groups or segments) in component (i.e. molecule) i.</span>
<span class="sd">    x0ii : numpy.ndarray</span>
<span class="sd">        Matrix of sigmaii_avg/dii_eff</span>
<span class="sd">    l_rii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) attractive exponent in component (i.e. molecule) i.</span>
<span class="sd">    l_aii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) attractive exponent in component (i.e. molecule) i.</span>
<span class="sd">    zetax : numpy.ndarray </span>
<span class="sd">        Matrix of hypothetical packing fraction based on hard sphere diameter for groups (k,l)</span>
<span class="sd">    stepmult : float, Optional, default: 1.0</span>
<span class="sd">        Factor, :math:`f_{step}`, used to change the step size used in derivative that is computed from the smallest representable positive number on the machine being used, where:</span>
<span class="sd">        :math:`step = f_{step} \sqrt{\epsilon_{smallest}}\rho_s`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    da2ii_1pchi_drhos : nump.ndarray</span>
<span class="sd">        Derivative of term with respect to segment density</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">stepmult</span>
    <span class="n">a2ii_1pchi_p</span> <span class="o">=</span> <span class="n">calc_a2ii_1pchi</span><span class="p">(</span><span class="n">rho</span> <span class="o">+</span> <span class="n">step</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>
    <span class="n">a2ii_1pchi_m</span> <span class="o">=</span> <span class="n">calc_a2ii_1pchi</span><span class="p">(</span><span class="n">rho</span> <span class="o">-</span> <span class="n">step</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,i-&gt;ij&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">a2ii_1pchi_p</span> <span class="o">-</span> <span class="n">a2ii_1pchi_m</span><span class="p">),</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span></div>

<div class="viewcode-block" id="calc_Achain"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_Achain.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_Achain">[docs]</a><span class="k">def</span> <span class="nf">calc_Achain</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">sigmakl</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">xskl</span><span class="p">,</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">l_akl</span><span class="p">,</span> <span class="n">beads</span><span class="p">,</span> <span class="n">beadlibrary</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">zetaxstar</span><span class="p">,</span> <span class="n">KHS</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of chain contribution of Helmholtz energy, :math:`A^{chain}`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rho : numpy.ndarray</span>
<span class="sd">        Number density of system [molecules/m^3]</span>
<span class="sd">    Cmol2seg : float</span>
<span class="sd">        Conversion factor from from molecular number density, :math:`\rho`, to segment (i.e. group) number density, :math:`\rho_S`. Shown in eq. 13</span>
<span class="sd">    xi : numpy.ndarray</span>
<span class="sd">        Mole fraction of each component, sum(xi) should equal 1.0</span>
<span class="sd">    T : float</span>
<span class="sd">        Temperature of the system [K]</span>
<span class="sd">    nui : numpy.array</span>
<span class="sd">        :math:`\nu_{i,k}/k_B`, Array of number of components by number of bead types. Defines the number of each type of group in each component. </span>
<span class="sd">        Defined for eq. 11. Note that indices are flipped from definition in reference.</span>
<span class="sd">    sigmakl : numpy.ndarray</span>
<span class="sd">        Matrix of mie diameter for groups (k,l)</span>
<span class="sd">    epsilonkl : numpy.ndarray</span>
<span class="sd">        Matrix of well depths for groups (k,l)</span>
<span class="sd">    dkl : numpy.ndarray</span>
<span class="sd">        Matrix of hardsphere diameters for groups (k,l)</span>
<span class="sd">    xskl : numpy.ndarray</span>
<span class="sd">        Matrix of mole fractions of bead (i.e. segment or group) k multiplied by bead l</span>
<span class="sd">    l_rkl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential attractive exponents for k,l groups</span>
<span class="sd">    l_akl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential attractive exponents for k,l groups</span>
<span class="sd">    beads : list[str]</span>
<span class="sd">        List of unique bead names used among components</span>
<span class="sd">    beadlibrary : dict</span>
<span class="sd">        A dictionary where bead names are the keys to access EOS self interaction parameters:</span>

<span class="sd">        * epsilon: :math:`\epsilon_{k,k}/k_B`, Energy well depth scaled by Boltzmann constant</span>
<span class="sd">        * sigma: :math:`\sigma_{k,k}`, Size parameter [m]</span>
<span class="sd">        * mass: Bead mass [kg/mol]</span>
<span class="sd">        * l_r: :math:`\lambda^{r}_{k,k}`, Exponent of repulsive term between groups of type k</span>
<span class="sd">        * l_a: :math:`\lambda^{a}_{k,k}`, Exponent of attractive term between groups of type k</span>
<span class="sd">        * Sk: :math:`S_{k}`, Shape parameter of group k</span>
<span class="sd">        * Vks: :math:`V_{k,s}`, Number of groups, k, in component</span>
<span class="sd">    zetax : numpy.ndarray </span>
<span class="sd">        Matrix of hypothetical packing fraction based on hard sphere diameter for groups (k,l)</span>
<span class="sd">    zetaxstar : numpy.ndarray</span>
<span class="sd">        Matrix of hypothetical packing fraction based on sigma for groups (k,l)</span>
<span class="sd">    KHS : numpy.ndarray</span>
<span class="sd">        (length of densities) isothermal compressibility of system with packing fraction zetax</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Achain : numpy.ndarray</span>
<span class="sd">        Chain contribution of Helmholtz energy, length of array rho</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1">#initialize values</span>
    <span class="n">ngroups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">beads</span><span class="p">)</span>
    <span class="n">ncomp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
    <span class="n">zki</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ncomp</span><span class="p">,</span> <span class="n">ngroups</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">zkinorm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncomp</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">sigmaii_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncomp</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">dii_eff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sigmaii_avg</span><span class="p">)</span>
    <span class="n">epsilonii_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sigmaii_avg</span><span class="p">)</span>
    <span class="n">l_rii_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sigmaii_avg</span><span class="p">)</span>
    <span class="n">l_aii_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sigmaii_avg</span><span class="p">)</span>
    <span class="n">x0ii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sigmaii_avg</span><span class="p">)</span>
    <span class="n">km</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">gdHS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="n">ncomp</span><span class="p">))</span>

    <span class="n">kT</span> <span class="o">=</span> <span class="n">T</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">kb</span>
    <span class="n">rhos</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">Cmol2seg</span>

    <span class="n">stepmult</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="c1">#compute zki</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngroups</span><span class="p">):</span>
            <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s2">&quot;Vks&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s2">&quot;Sk&quot;</span><span class="p">]</span>
            <span class="n">zkinorm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngroups</span><span class="p">):</span>
            <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">zkinorm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># compute average molecular segment size: sigmaii_avg</span>
    <span class="c1"># compute effective hard sphere diameter : dii_eff</span>
    <span class="c1"># compute average interaction energy epsilonii_avg</span>
    <span class="c1">#compute average repulsive and attractive exponenets l_rkl, l_akl</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngroups</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngroups</span><span class="p">):</span>
                <span class="n">sigmaii_avg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">*</span> <span class="n">sigmakl</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span>
                <span class="n">dii_eff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">*</span> <span class="n">dkl</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span>
                <span class="n">epsilonii_avg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">*</span> <span class="n">epsilonkl</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">kb</span>
                <span class="n">l_rii_avg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">*</span> <span class="n">l_rkl</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span>
                <span class="n">l_aii_avg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">zki</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">*</span> <span class="n">l_akl</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span>
        <span class="n">dii_eff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dii_eff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span>
        <span class="n">sigmaii_avg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigmaii_avg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span>

    <span class="c1">#compute x0ii</span>
    <span class="n">x0ii</span> <span class="o">=</span> <span class="n">sigmaii_avg</span><span class="o">/</span><span class="n">dii_eff</span>

    <span class="n">km</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">zetax</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">42.0</span> <span class="o">*</span> <span class="n">zetax</span> <span class="o">-</span> <span class="mf">39.0</span> <span class="o">*</span> <span class="n">zetax</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">9.0</span> <span class="o">*</span> <span class="n">zetax</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">zetax</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">6.0</span> <span class="o">*</span>
              <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">zetax</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">km</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">zetax</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mf">6.0</span> <span class="o">*</span> <span class="n">zetax</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">12.0</span> <span class="o">*</span> <span class="n">zetax</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">zetax</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">km</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">zetax</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">8.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">zetax</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">km</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">zetax</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">zetax</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">zetax</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">6.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">zetax</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
        <span class="n">gdHS</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">km</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">km</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x0ii</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">km</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">x0ii</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">km</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">x0ii</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">da1iidrhos</span> <span class="o">=</span> <span class="n">calc_da1iidrhos</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">stepmult</span><span class="o">=</span><span class="n">stepmult</span><span class="p">)</span>

    <span class="n">a1sii_l_aii_avg</span> <span class="o">=</span> <span class="n">calc_a1s</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">)</span>
    <span class="n">a1sii_l_rii_avg</span> <span class="o">=</span> <span class="n">calc_a1s</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">)</span>

    <span class="n">Bii_l_aii_avg</span> <span class="o">=</span> <span class="n">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>
    <span class="n">Bii_l_rii_avg</span> <span class="o">=</span> <span class="n">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>

    <span class="n">Cii</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">)</span>

    <span class="n">g1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">epsilonii_avg</span> <span class="o">*</span> <span class="n">dii_eff</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">da1iidrhos</span> <span class="o">-</span> <span class="n">Cii</span> <span class="o">*</span> <span class="n">l_aii_avg</span> <span class="o">*</span> <span class="p">(</span><span class="n">x0ii</span><span class="o">**</span><span class="n">l_aii_avg</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,i-&gt;ij&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">a1sii_l_aii_avg</span> <span class="o">+</span> <span class="n">Bii_l_aii_avg</span><span class="p">),</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">rhos</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">Cii</span> <span class="o">*</span> <span class="n">l_rii_avg</span> <span class="o">*</span>  <span class="p">(</span><span class="n">x0ii</span><span class="o">**</span><span class="n">l_rii_avg</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,i-&gt;ij&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">a1sii_l_rii_avg</span> <span class="o">+</span> <span class="n">Bii_l_rii_avg</span><span class="p">),</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">rhos</span><span class="p">))</span>

    <span class="c1">#compute g2</span>
    <span class="n">phi7</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0</span><span class="p">])</span>
    <span class="n">alphaii</span> <span class="o">=</span> <span class="n">Cii</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">l_aii_avg</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">l_rii_avg</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">)))</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">epsilonii_avg</span> <span class="o">/</span> <span class="n">kT</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>

    <span class="n">gammacii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">gdHS</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
        <span class="n">gammacii</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi7</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">phi7</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi7</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">alphaii</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span>
                                    <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">zetaxstar</span> <span class="o">*</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">phi7</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">zetaxstar</span> <span class="o">+</span> <span class="n">phi7</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">zetaxstar</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">a2iidchi</span> <span class="o">=</span> <span class="n">calc_a2ii_1pchi</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>

    <span class="n">da2iidrhos</span> <span class="o">=</span> <span class="n">calc_da2ii_1pchi_drhos</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">stepmult</span><span class="o">=</span><span class="n">stepmult</span><span class="p">)</span>

    <span class="n">a1sii_2l_aii_avg</span> <span class="o">=</span> <span class="n">calc_a1s</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">)</span>
    <span class="n">a1sii_2l_rii_avg</span> <span class="o">=</span> <span class="n">calc_a1s</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">)</span>
    <span class="n">a1sii_l_rii_avgl_aii_avg</span> <span class="o">=</span> <span class="n">calc_a1s</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">l_aii_avg</span> <span class="o">+</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">)</span>

    <span class="n">Bii_2l_aii_avg</span> <span class="o">=</span> <span class="n">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_aii_avg</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>
    <span class="n">Bii_2l_rii_avg</span> <span class="o">=</span> <span class="n">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>
    <span class="n">Bii_l_aii_avgl_rii_avg</span> <span class="o">=</span> <span class="n">calc_Bkl</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">l_aii_avg</span> <span class="o">+</span> <span class="n">l_rii_avg</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">dii_eff</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">x0ii</span><span class="p">,</span> <span class="n">zetax</span><span class="p">)</span>

    <span class="n">eKC2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,j-&gt;ij&quot;</span><span class="p">,</span> <span class="n">KHS</span> <span class="o">/</span> <span class="n">rhos</span><span class="p">,</span> <span class="n">epsilonii_avg</span> <span class="o">*</span> <span class="p">(</span><span class="n">Cii</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">g2MCA</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">epsilonii_avg</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dii_eff</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">da2iidrhos</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">eKC2</span> <span class="o">*</span> <span class="n">l_rii_avg</span> <span class="o">*</span> <span class="p">(</span><span class="n">x0ii</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_rii_avg</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="n">a1sii_2l_rii_avg</span> <span class="o">+</span> <span class="n">Bii_2l_rii_avg</span><span class="p">)</span> <span class="o">+</span> <span class="n">eKC2</span> <span class="o">*</span> <span class="p">(</span><span class="n">l_rii_avg</span> <span class="o">+</span> <span class="n">l_aii_avg</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x0ii</span><span class="o">**</span><span class="p">(</span><span class="n">l_rii_avg</span> <span class="o">+</span> <span class="n">l_aii_avg</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">a1sii_l_rii_avgl_aii_avg</span> <span class="o">+</span> <span class="n">Bii_l_aii_avgl_rii_avg</span><span class="p">)</span> <span class="o">-</span> <span class="n">eKC2</span> <span class="o">*</span> <span class="n">l_aii_avg</span> <span class="o">*</span> <span class="p">(</span><span class="n">x0ii</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">l_aii_avg</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">a1sii_2l_aii_avg</span> <span class="o">+</span> <span class="n">Bii_2l_aii_avg</span><span class="p">))</span>

    <span class="n">g2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">gammacii</span><span class="p">)</span> <span class="o">*</span> <span class="n">g2MCA</span>
    <span class="c1">#g2=np.einsum(&quot;i,ij-&gt;ij&quot;,1.0+gammacii,g2MCA)</span>

    <span class="c1">#print(np.exp((epsilonii_avg*g1/(kT*gdHS))+(((epsilonii_avg/kT)**2)*g2/gdHS)))</span>
    <span class="n">gii</span> <span class="o">=</span> <span class="n">gdHS</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">epsilonii_avg</span> <span class="o">*</span> <span class="n">g1</span> <span class="o">/</span> <span class="p">(</span><span class="n">kT</span> <span class="o">*</span> <span class="n">gdHS</span><span class="p">))</span> <span class="o">+</span> <span class="p">(((</span><span class="n">epsilonii_avg</span> <span class="o">/</span> <span class="n">kT</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">g2</span> <span class="o">/</span> <span class="n">gdHS</span><span class="p">))</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">epsilonii_avg</span> <span class="o">*</span> <span class="n">g1</span> <span class="o">/</span> <span class="p">(</span><span class="n">kT</span> <span class="o">*</span> <span class="n">gdHS</span><span class="p">)),</span> <span class="p">(((</span><span class="n">epsilonii_avg</span> <span class="o">/</span> <span class="n">kT</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">g2</span> <span class="o">/</span> <span class="n">gdHS</span><span class="p">)]</span>
    <span class="n">Achain</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">tmp_A</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
        <span class="n">beadsum</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngroups</span><span class="p">):</span>
            <span class="n">beadsum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s2">&quot;Vks&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s2">&quot;Sk&quot;</span><span class="p">])</span>

        <span class="n">Achain</span> <span class="o">-=</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">beadsum</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">gii</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
        <span class="n">tmp_A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">tmp_A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="n">i</span><span class="p">]</span>

    <span class="c1">#return Achain,sigmaii_avg,epsilonii_avg,np.array(tmp_A)</span>
    <span class="k">return</span> <span class="n">Achain</span><span class="p">,</span> <span class="n">sigmaii_avg</span><span class="p">,</span> <span class="n">epsilonii_avg</span></div>

<span class="c1">############################################################</span>
<span class="c1">#                                                          #</span>
<span class="c1">#            A Association Site Contribution               #</span>
<span class="c1">#                                                          #</span>
<span class="c1">############################################################</span>

<div class="viewcode-block" id="calc_assoc_matrices"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_assoc_matrices.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_assoc_matrices">[docs]</a><span class="k">def</span> <span class="nf">calc_assoc_matrices</span><span class="p">(</span><span class="n">beads</span><span class="p">,</span> <span class="n">beadlibrary</span><span class="p">,</span> <span class="n">sitenames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;e1&quot;</span><span class="p">,</span> <span class="s2">&quot;e2&quot;</span><span class="p">],</span> <span class="n">crosslibrary</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Generate matrices used for association site calculations.  Compute epsilonHB (interaction energy for association term),Kklab (association interaction bonding volume,nk (number of sites )</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    beads : list[str]</span>
<span class="sd">        List of unique bead names used among components</span>
<span class="sd">    beadlibrary : dict</span>
<span class="sd">        A dictionary where bead names are the keys to access EOS self interaction parameters:</span>

<span class="sd">        * epsilon: :math:`\epsilon_{k,k}/k_B`, Energy well depth scaled by Boltzmann constant</span>
<span class="sd">        * sigma: :math:`\sigma_{k,k}`, Size parameter [m]</span>
<span class="sd">        * mass: Bead mass [kg/mol]</span>
<span class="sd">        * l_r: :math:`\lambda^{r}_{k,k}`, Exponent of repulsive term between groups of type k</span>
<span class="sd">        * l_a: :math:`\lambda^{a}_{k,k}`, Exponent of attractive term between groups of type k</span>
<span class="sd">        * Sk: :math:`S_{k}`, Shape parameter of group k</span>
<span class="sd">        * Vks: :math:`V_{k,s}`, Number of groups, k, in component</span>
<span class="sd">    sitenames : list[str], Optional, default: []</span>
<span class="sd">        List of unique association sites used among components</span>
<span class="sd">    crosslibrary : dict, Optional, default: {}</span>
<span class="sd">        Optional library of bead cross interaction parameters. As many or as few of the desired parameters may be defined for whichever group combinations are desired.</span>

<span class="sd">        * epsilon: :math:`\epsilon_{k,l}/k_B`, Energy parameter scaled by Boltzmann Constant</span>
<span class="sd">        * l_r: :math:`\lambda^{r}_{k,l}`, Exponent of repulsive term between groups of type k and l</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    epsilonHB : numpy.ndarray</span>
<span class="sd">        Interaction energy between each bead and association site.</span>
<span class="sd">    Kklab : numpy.ndarray </span>
<span class="sd">        Bonding volume between each association site</span>
<span class="sd">    nk : numpy.ndarray</span>
<span class="sd">        For each bead the number of each type of site</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1"># initialize variables</span>
    <span class="n">nbeads</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">beads</span><span class="p">)</span>
    <span class="n">sitemax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">sitenames</span><span class="p">)</span>
    <span class="n">epsilonHB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbeads</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">,</span> <span class="n">sitemax</span><span class="p">,</span> <span class="n">sitemax</span><span class="p">))</span>
    <span class="n">Kklab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbeads</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">,</span> <span class="n">sitemax</span><span class="p">,</span> <span class="n">sitemax</span><span class="p">))</span>
    <span class="n">nk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbeads</span><span class="p">,</span> <span class="n">sitemax</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbeads</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">sitenames</span><span class="p">)):</span>
            <span class="k">if</span> <span class="s2">&quot;Nk&quot;</span><span class="o">+</span><span class="n">sitenames</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">i</span><span class="p">]]:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Bead </span><span class="si">{}</span><span class="s2"> has </span><span class="si">{}</span><span class="s2"> of the association site </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">beads</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;Nk&quot;</span><span class="o">+</span><span class="n">sitenames</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span><span class="s2">&quot;Nk&quot;</span><span class="o">+</span><span class="n">sitenames</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                <span class="n">nk</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;Nk&quot;</span> <span class="o">+</span> <span class="n">sitenames</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>

    <span class="k">if</span> <span class="n">crosslibrary</span><span class="p">:</span>
        <span class="c1"># find any cross terms in the cross term library</span>
        <span class="n">crosslist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">beadname</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">beads</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">beadname</span> <span class="ow">in</span> <span class="n">crosslibrary</span><span class="p">:</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">beadname2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">beads</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">beadname2</span> <span class="ow">in</span> <span class="n">crosslibrary</span><span class="p">[</span><span class="n">beadname</span><span class="p">]:</span>
                        <span class="n">crosslist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">crosslist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">sitenames</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">sitenames</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="ow">in</span> <span class="n">crosslibrary</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="ow">in</span> <span class="n">crosslibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]]:</span>
                            
                            <span class="n">epsilon_tmp</span> <span class="o">=</span> <span class="s2">&quot;epsilon&quot;</span><span class="o">+</span><span class="n">sitenames</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">+</span><span class="n">sitenames</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
                            <span class="n">K_tmp</span> <span class="o">=</span> <span class="s2">&quot;K&quot;</span><span class="o">+</span><span class="n">sitenames</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">+</span><span class="n">sitenames</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">epsilon_tmp</span> <span class="ow">in</span> <span class="n">crosslibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]][</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]]:</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">nk</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="n">a</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">nk</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]][</span><span class="n">b</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                                    <span class="k">if</span> <span class="mi">0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">nk</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="n">b</span><span class="p">],</span><span class="n">nk</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]][</span><span class="n">a</span><span class="p">]]:</span>
                                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Site names were listed in wrong order for parameter definitions in cross interaction library. Changing </span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2"> interaction to </span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span><span class="n">sitenames</span><span class="p">[</span><span class="n">a</span><span class="p">],</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span><span class="n">sitenames</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span><span class="n">sitenames</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span><span class="n">sitenames</span><span class="p">[</span><span class="n">a</span><span class="p">]))</span>
                                        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span>
                                    <span class="k">elif</span> <span class="n">nk</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="n">a</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Cross interaction library parameters suggest a </span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2"> interaction, but </span><span class="si">{}</span><span class="s2"> doesn&#39;t have site </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span><span class="n">sitenames</span><span class="p">[</span><span class="n">a</span><span class="p">],</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span><span class="n">sitenames</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span><span class="n">sitenames</span><span class="p">[</span><span class="n">a</span><span class="p">]))</span>
                                    <span class="k">elif</span> <span class="n">nk</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]][</span><span class="n">b</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Cross interaction library parameters suggest a </span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2"> interaction, but </span><span class="si">{}</span><span class="s2"> doesn&#39;t have site </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span><span class="n">sitenames</span><span class="p">[</span><span class="n">a</span><span class="p">],</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span><span class="n">sitenames</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span><span class="n">sitenames</span><span class="p">[</span><span class="n">b</span><span class="p">]))</span>

                                <span class="n">epsilonHB</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="n">crosslibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]][</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]][</span><span class="n">epsilon_tmp</span><span class="p">]</span>
                                <span class="n">epsilonHB</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">epsilonHB</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>

                            <span class="k">if</span> <span class="n">K_tmp</span> <span class="ow">in</span> <span class="n">crosslibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]][</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]]:</span>
                                <span class="n">Kklab</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="n">crosslibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]][</span><span class="n">beads</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]][</span><span class="n">K_tmp</span><span class="p">]</span>
                                <span class="n">Kklab</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">Kklab</span><span class="p">[</span><span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">crosslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbeads</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">sitenames</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">sitenames</span><span class="p">)):</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;epsilon&quot;</span><span class="o">+</span><span class="n">sitenames</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">+</span><span class="n">sitenames</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="s2">&quot;K&quot;</span><span class="o">+</span><span class="n">sitenames</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">+</span><span class="n">sitenames</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">):</span>
                    <span class="n">epsilonHB</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;epsilon&quot;</span> <span class="o">+</span> <span class="n">sitenames</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+</span> <span class="n">sitenames</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span>
                    <span class="n">epsilonHB</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">epsilonHB</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>
                    <span class="n">Kklab</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">beadlibrary</span><span class="p">[</span><span class="n">beads</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;K&quot;</span> <span class="o">+</span> <span class="n">sitenames</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+</span> <span class="n">sitenames</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span>
                    <span class="n">Kklab</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">Kklab</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">Kklab</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">Kklab</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mf">1e-27</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Check units for association site parameter K. Should be in units of m^3.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">epsilonHB</span><span class="p">,</span> <span class="n">Kklab</span><span class="p">,</span> <span class="n">nk</span></div>

<div class="viewcode-block" id="calc_Xika_wrap"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_Xika_wrap.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_Xika_wrap">[docs]</a><span class="k">def</span> <span class="nf">calc_Xika_wrap</span><span class="p">(</span><span class="n">Xika0</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">nk</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses Fortran modules to calculate the fraction of molecules of component i that are not bonded at a site of type a on group k.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xi : numpy.ndarray</span>
<span class="sd">        Mole fraction of each component, sum(xi) should equal 1.0</span>
<span class="sd">    rho : numpy.ndarray</span>
<span class="sd">        Number density of system [molecules/m^3]</span>
<span class="sd">    nui : numpy.array</span>
<span class="sd">        :math:`\nu_{i,k}/k_B`, Array of number of components by number of bead types. Defines the number of each type of group in each component. </span>
<span class="sd">        Defined for eq. 11. Note that indices are flipped from definition in reference.</span>
<span class="sd">    nk : numpy.ndarray</span>
<span class="sd">        For each bead the number of each type of site</span>
<span class="sd">    delta : numpy.ndarray</span>
<span class="sd">        The association strength between a site of type a on a group of type k of component i and a site of type b on a group of type l of component j. eq. 66</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    obj_func : </span>
<span class="sd">        Used in calculation of association term of Helmholtz energy</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1"># val=solv_assoc.calc_xika(Xika0,xi,rho,nui,nk,delta)</span>
    <span class="n">obj_func</span><span class="p">,</span> <span class="n">Xika</span> <span class="o">=</span> <span class="n">solv_assoc</span><span class="o">.</span><span class="n">calc_xika</span><span class="p">(</span><span class="n">Xika0</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">nk</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj_func</span></div>

<div class="viewcode-block" id="calc_A_assoc"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_A_assoc.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_A_assoc">[docs]</a><span class="k">def</span> <span class="nf">calc_A_assoc</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">xskl</span><span class="p">,</span> <span class="n">sigmakl</span><span class="p">,</span> <span class="n">sigmaii_avg</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">epsilonHB</span><span class="p">,</span> <span class="n">Kklab</span><span class="p">,</span> <span class="n">nk</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the association contribution of the Helmholtz energy, :math:`A^{assoc.}`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rho : numpy.ndarray</span>
<span class="sd">        Number density of system [molecules/m^3]</span>
<span class="sd">    xi : numpy.ndarray</span>
<span class="sd">        Mole fraction of each component, sum(xi) should equal 1.0</span>
<span class="sd">    T : float</span>
<span class="sd">        Temperature of the system [K]</span>
<span class="sd">    nui : numpy.array</span>
<span class="sd">        :math:`\nu_{i,k}/k_B`, Array of number of components by number of bead types. Defines the number of each type of group in each component. </span>
<span class="sd">    xskl : numpy.ndarray</span>
<span class="sd">        Matrix of mole fractions of bead (i.e. segment or group) k multiplied by bead l</span>
<span class="sd">    sigmakl : numpy.ndarray</span>
<span class="sd">        Matrix of mie diameter for groups (k,l)</span>
<span class="sd">    sigmaii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) size in component (i.e. molecule) i.</span>
<span class="sd">    epsilonii_avg : numpy.ndarray</span>
<span class="sd">        Average bead (i.e. group or segment) potential well depth in component (i.e. molecule) i.</span>
<span class="sd">    epsilonHB : numpy.ndarray</span>
<span class="sd">        Interaction energy between each bead and association site.</span>
<span class="sd">    Kklab : numpy.ndarray </span>
<span class="sd">        Bonding volume between each association site</span>
<span class="sd">    nk : numpy.ndarray</span>
<span class="sd">        For each bead the number of each type of site</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Aassoc : numpy.ndarray</span>
<span class="sd">        Association site contribution of Helmholtz energy, length of array rho</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">kT</span> <span class="o">=</span> <span class="n">T</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">kb</span>
    <span class="n">nbeads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nui</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ncomp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
    <span class="n">nsitesmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">nk</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Fklab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbeads</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">,</span> <span class="n">nsitesmax</span><span class="p">,</span> <span class="n">nsitesmax</span><span class="p">))</span>
    <span class="n">epsilonij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ncomp</span><span class="p">,</span> <span class="n">ncomp</span><span class="p">))</span>
    <span class="n">Iij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="n">ncomp</span><span class="p">,</span> <span class="n">ncomp</span><span class="p">))</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="n">ncomp</span><span class="p">,</span> <span class="n">ncomp</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">,</span> <span class="n">nsitesmax</span><span class="p">,</span> <span class="n">nsitesmax</span><span class="p">))</span>
    <span class="n">Xika</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="n">ncomp</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">,</span> <span class="n">nsitesmax</span><span class="p">))</span>
    <span class="n">Aassoc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>

    <span class="c1"># compute F_klab</span>
    <span class="n">Fklab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">epsilonHB</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">kb</span> <span class="o">/</span> <span class="n">kT</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>

    <span class="c1"># compute epsilonij</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ncomp</span><span class="p">):</span>
            <span class="n">epsilonij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigmaii_avg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">sigmaii_avg</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">**</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">epsilonii_avg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">epsilonii_avg</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">((</span>
                <span class="p">(</span><span class="n">sigmaii_avg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">sigmaii_avg</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">epsilonij</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">epsilonij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="c1"># compute sigmax3</span>
    <span class="n">sigmax3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xskl</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigmakl</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>

    <span class="c1"># compute Iijklab </span>
    <span class="c1"># {BottleNeck}</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span> <span class="o">-</span> <span class="n">p</span><span class="p">):</span>
            <span class="c1">#Iij += np.einsum(&quot;i,jk-&gt;ijk&quot;, constants.cij[p, q] * ((sigmax3 * rho)**p), ((kT / epsilonij)**q))</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">Iij</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk-&gt;ijk&quot;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho</span><span class="p">)),</span> <span class="p">((</span><span class="n">kT</span> <span class="o">/</span> <span class="n">epsilonij</span><span class="p">)</span><span class="o">**</span><span class="n">q</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Iij</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk-&gt;ijk&quot;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">sigmax3</span> <span class="o">*</span> <span class="n">rho</span><span class="p">)),</span> <span class="p">((</span><span class="n">kT</span> <span class="o">/</span> <span class="n">epsilonij</span><span class="p">)</span><span class="o">**</span><span class="n">q</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> 
               <span class="n">rho2</span> <span class="o">=</span> <span class="n">rho</span><span class="o">**</span><span class="mi">2</span>
               <span class="n">Iij</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk-&gt;ijk&quot;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">sigmax3</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">rho2</span><span class="p">)),</span> <span class="p">((</span><span class="n">kT</span> <span class="o">/</span> <span class="n">epsilonij</span><span class="p">)</span><span class="o">**</span><span class="n">q</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> 
                <span class="n">rho3</span> <span class="o">=</span> <span class="n">rho2</span><span class="o">*</span><span class="n">rho</span>
                <span class="n">Iij</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk-&gt;ijk&quot;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">sigmax3</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">rho3</span><span class="p">)),</span> <span class="p">((</span><span class="n">kT</span> <span class="o">/</span> <span class="n">epsilonij</span><span class="p">)</span><span class="o">**</span><span class="n">q</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> 
                <span class="n">rho4</span> <span class="o">=</span> <span class="n">rho2</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">Iij</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk-&gt;ijk&quot;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">sigmax3</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">rho4</span><span class="p">)),</span> <span class="p">((</span><span class="n">kT</span> <span class="o">/</span> <span class="n">epsilonij</span><span class="p">)</span><span class="o">**</span><span class="n">q</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> 
                <span class="n">rho5</span> <span class="o">=</span> <span class="n">rho2</span><span class="o">*</span><span class="n">rho3</span>
                <span class="n">Iij</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk-&gt;ijk&quot;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">sigmax3</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">rho5</span><span class="p">)),</span> <span class="p">((</span><span class="n">kT</span> <span class="o">/</span> <span class="n">epsilonij</span><span class="p">)</span><span class="o">**</span><span class="n">q</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span> <span class="n">Iij</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk-&gt;ijk&quot;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">sigmax3</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">rho</span><span class="o">*</span><span class="n">rho5</span><span class="p">)),</span> <span class="p">((</span><span class="n">kT</span> <span class="o">/</span> <span class="n">epsilonij</span><span class="p">)</span><span class="o">**</span><span class="n">q</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span> <span class="n">Iij</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk-&gt;ijk&quot;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">sigmax3</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">rho2</span><span class="o">*</span><span class="n">rho5</span><span class="p">)),</span> <span class="p">((</span><span class="n">kT</span> <span class="o">/</span> <span class="n">epsilonij</span><span class="p">)</span><span class="o">**</span><span class="n">q</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span> <span class="n">Iij</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk-&gt;ijk&quot;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">sigmax3</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">rho3</span><span class="o">*</span><span class="n">rho5</span><span class="p">)),</span> <span class="p">((</span><span class="n">kT</span> <span class="o">/</span> <span class="n">epsilonij</span><span class="p">)</span><span class="o">**</span><span class="n">q</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span> <span class="n">Iij</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk-&gt;ijk&quot;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">sigmax3</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">rho4</span><span class="o">*</span><span class="n">rho5</span><span class="p">)),</span> <span class="p">((</span><span class="n">kT</span> <span class="o">/</span> <span class="n">epsilonij</span><span class="p">)</span><span class="o">**</span><span class="n">q</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span> <span class="n">Iij</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i,jk-&gt;ijk&quot;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">sigmax3</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="n">rho5</span><span class="o">*</span><span class="n">rho5</span><span class="p">)),</span> <span class="p">((</span><span class="n">kT</span> <span class="o">/</span> <span class="n">epsilonij</span><span class="p">)</span><span class="o">**</span><span class="n">q</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">disable_jit</span><span class="p">:</span>
        <span class="c1"># Compute Xika: with Fortran   {BottleNeck}</span>
        <span class="c1"># compute deltaijklab</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbeads</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbeads</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsitesmax</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsitesmax</span><span class="p">):</span>
                                <span class="c1"># print(Fklab[k,l,a,b],Kklab[k,l,a,b],Iij[i,j])</span>
                                <span class="k">if</span> <span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="ow">and</span> <span class="n">nui</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">delta</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">Fklab</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">*</span> <span class="n">Kklab</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">*</span> <span class="n">Iij</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    
        <span class="n">Xika0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ncomp</span><span class="p">,</span> <span class="n">nbeads</span><span class="p">,</span> <span class="n">nsitesmax</span><span class="p">))</span>
        <span class="n">Xika0</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">Xika</span> <span class="o">=</span> <span class="n">solv_assoc</span><span class="o">.</span><span class="n">min_xika</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Xika0</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">nk</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mf">1.0E-12</span><span class="p">)</span> <span class="c1"># {BottleNeck}</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">Xika</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">Xika0</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">spo</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">calc_Xika_wrap</span><span class="p">,</span> <span class="n">Xika0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">rho</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nui</span><span class="p">,</span> <span class="n">nk</span><span class="p">,</span> <span class="n">delta</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;broyden1&#39;</span><span class="p">)</span>
            <span class="n">Xika0</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span>
            <span class="n">Xika</span> <span class="o">=</span> <span class="n">solv_assoc</span><span class="o">.</span><span class="n">min_xika</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Xika0</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">nk</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mf">1.0E-12</span><span class="p">)</span> <span class="c1"># {BottleNeck}</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Xika out of bounds&#39;</span><span class="p">)</span>

      <span class="c1">#  obj = 0</span>
      <span class="c1">#  for i in range(len(rho)):</span>
      <span class="c1">#      obj += abs(calc_Xika_wrap(Xika[i], xi, rho[i], nui, nk, delta[i]))</span>
      <span class="c1">#  print(&quot;obj&quot;,np.sum(obj))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Compute Xika: with python with numba  {BottleNeck}</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">assoc_site_indices</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">nk</span><span class="p">)</span>
        <span class="n">Xika</span><span class="p">,</span> <span class="n">err_array</span> <span class="o">=</span> <span class="n">calc_Xika</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">nk</span><span class="p">,</span> <span class="n">Fklab</span><span class="p">,</span> <span class="n">Kklab</span><span class="p">,</span> <span class="n">Iij</span><span class="p">)</span>

    <span class="c1"># Compute Xika: with python  {BottleNeck}</span>
<span class="c1">#    Xika = []</span>
<span class="c1">#    status = []</span>
<span class="c1">#    l_ind = len(indices)</span>
<span class="c1">#    #logger.debug(&quot;association site indices {}&quot;.format(indices))</span>
<span class="c1">#    Xika_elements = np.ones(l_ind)*.5</span>
<span class="c1">#    err = 0</span>
<span class="c1">#    for i in range(len(rho)):</span>
<span class="c1">#        bounds = (np.zeros(l_ind),np.ones(l_ind))</span>
<span class="c1">#        sol = spo.least_squares(obj_Xika, Xika_elements, bounds=bounds, args=(indices,rho[i], xi, nui, nk, Fklab,Kklab,Iij[i]))</span>
<span class="c1">#        Xika_elements = sol.x</span>
<span class="c1">#        err += np.sum(obj_Xika(Xika_elements,indices,rho[i], xi, nui, nk, Fklab,Kklab,Iij[i]))</span>
<span class="c1">#        status.append(sol.status)</span>
<span class="c1">#        Xika_tmp = np.ones((ncomp, nbeads, nsitesmax))</span>
<span class="c1">#        Xika.append(assemble_Xika(Xika_elements,indices,Xika_tmp))</span>
<span class="c1">#    Xika = np.array(Xika)</span>
<span class="c1">#    unique, counts = np.unique(status, return_counts=True)</span>
<span class="c1">#    logger.debug(&quot;    Xika Status Flags: {}: {}&quot;.format(unique, counts))</span>
<span class="c1">#    print(&quot;error {}&quot;.format(err))</span>

    <span class="c1"># Compute A_assoc</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbeads</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsitesmax</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">nk</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">Aassoc</span> <span class="o">+=</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">nk</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Xika</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="p">])</span> <span class="o">+</span>
                                                              <span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">Xika</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span>

   <span class="c1"># nrho = int(len(Aassoc)/2)</span>
   <span class="c1"># print(&quot;Total Aassoc {}&quot;.format(np.sum(Aassoc[:nrho]-Aassoc[nrho:])))</span>
   <span class="c1"># plt.plot([rho[0],rho[nrho-1]],[0,0])</span>
   <span class="c1"># plt.plot(rho[:nrho],Aassoc[:nrho]-Aassoc[nrho:])</span>
   <span class="c1"># plt.show()</span>

    <span class="k">return</span> <span class="n">Aassoc</span></div>

<div class="viewcode-block" id="assoc_site_indices"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.assoc_site_indices.html#despasito.equations_of_state.saft.gamma_mie_funcs.assoc_site_indices">[docs]</a><span class="k">def</span> <span class="nf">assoc_site_indices</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">nk</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Make a list of sets of indices that allow quick identification of the relevent association sights. This is needed for solving Xika, the fraction of molecules of component i that are not bonded at a site of type a on group k.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xi : numpy.ndarray</span>
<span class="sd">        Mole fraction of each component, sum(xi) should equal 1.0</span>
<span class="sd">    nui : numpy.array</span>
<span class="sd">        :math:`\nu_{i,k}/k_B`, Array of number of components by number of bead types. Defines the number of each type of group in each component. </span>
<span class="sd">    nk : numpy.ndarray</span>
<span class="sd">        For each bead the number of each type of site</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    indices : list[list]</span>
<span class="sd">        A list of sets of (component, bead, site) to identify the values of the Xika matrix that are being fit</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># List of site indicies for each bead type</span>
    <span class="n">bead_sites</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">bead</span> <span class="ow">in</span> <span class="n">nk</span><span class="p">:</span>
        <span class="n">bead_sites</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">site</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bead</span><span class="p">)</span> <span class="k">if</span> <span class="n">site</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Indices of components will minimal mole fractions</span>
    <span class="n">zero_frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-32</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nui</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">zero_frac</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">bead</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">comp</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">bead</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">bead_sites</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">bead_sites</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                        <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">])</span>

    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">indices</span></div>

<div class="viewcode-block" id="obj_Xika"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.obj_Xika.html#despasito.equations_of_state.saft.gamma_mie_funcs.obj_Xika">[docs]</a><span class="k">def</span> <span class="nf">obj_Xika</span><span class="p">(</span><span class="n">Xika_elements</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">nk</span><span class="p">,</span> <span class="n">Fklab</span><span class="p">,</span> <span class="n">Kklab</span><span class="p">,</span> <span class="n">Iij</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Calculate the fraction of molecules of component i that are not bonded at a site of type a on group k in an iterative fashion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Xika_elements : numpy.ndarray</span>
<span class="sd">        A guess in the value of the elements</span>
<span class="sd">    indices : list[list]</span>
<span class="sd">        A list of sets of (component, bead, site) to identify the values of the Xika matrix that are being fit</span>
<span class="sd">    rho : float</span>
<span class="sd">        Number density of system [molecules/m^3]</span>
<span class="sd">    xi : numpy.ndarray</span>
<span class="sd">        Mole fraction of each component, sum(xi) should equal 1.0</span>
<span class="sd">    nui : numpy.array</span>
<span class="sd">        :math:`\nu_{i,k}/k_B`, Array of number of components by number of bead types. Defines the number of each type of group in each component. </span>
<span class="sd">    nk : numpy.ndarray</span>
<span class="sd">        For each bead the number of each type of site</span>
<span class="sd">    delta : numpy.ndarray</span>
<span class="sd">        The association strength between a site of type a on a group of type k of component i and a site of type b on a group of type l of component j. eq. 66, for a specific density</span>
<span class="sd">    Fklab : numpy.ndarray</span>
<span class="sd">        </span>
<span class="sd">    Kklab : numpy.ndarray</span>
<span class="sd">        </span>
<span class="sd">    Iij : numpy.ndarray</span>
<span class="sd">        </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    obj : numpy.ndarray</span>
<span class="sd">        The sum of the absolute difference between each of the target elements.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1">## Option 1: A lot of for loops</span>
<span class="c1">#    nbeads    = nui.shape[1]</span>
<span class="c1">#    ncomp     = np.size(xi)</span>
<span class="c1">#    nsitesmax = np.size(nk, axis=1)</span>
<span class="c1">#</span>
<span class="c1">#    Xika = np.ones((ncomp, nbeads, nsitesmax))</span>
<span class="c1">#    Xika0 = assemble_Xika(Xika_elements,indices,Xika)</span>
<span class="c1">#    for i in range(ncomp):</span>
<span class="c1">#        for k in range(nbeads):</span>
<span class="c1">#            for a in range(nsitesmax):</span>
<span class="c1">#</span>
<span class="c1">#                for j in range(ncomp):</span>
<span class="c1">#                    for l in range(nbeads):</span>
<span class="c1">#                        for b in range(nsitesmax):</span>
<span class="c1">#                            Xika[i,k,a] += (rho * xi[j] * nui[j,l] * nk[l,b] * Xika0[j,l,b] * delta[i,j,k,l,a,b])</span>
<span class="c1">#    Xika = 1./Xika</span>
<span class="c1">#    Xika_elements_new = [Xika[i][j][k] for i,j,k in indices]</span>

    <span class="c1">## Option 2: Fewer forloops</span>
    <span class="n">Xika_elements_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Xika_elements</span><span class="p">))</span>
    <span class="n">Xika_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Xika_elements</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">jnd</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">Fklab</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">*</span> <span class="n">Kklab</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">*</span> <span class="n">Iij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">Xika_elements_new</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">xi</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">nui</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">*</span> <span class="n">nk</span><span class="p">[</span><span class="n">l</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">*</span> <span class="n">Xika_elements</span><span class="p">[</span><span class="n">jnd</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta</span>
            <span class="n">jnd</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">Xika_elements_new</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">Xika_elements_new</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">Xika_elements_new</span> <span class="o">-</span> <span class="n">Xika_elements</span><span class="p">)</span><span class="o">/</span><span class="n">Xika_elements</span>

    
    <span class="c1">#print(&quot;Xika guess and obj &quot;,Xika_elements,Xika_elements_new,obj)</span>

    <span class="c1">#logger.debug(&quot;    Xika: {}, Error: {}&quot;.format(Xika_elements_new,obj))</span>

    <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="assemble_Xika"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.assemble_Xika.html#despasito.equations_of_state.saft.gamma_mie_funcs.assemble_Xika">[docs]</a><span class="k">def</span> <span class="nf">assemble_Xika</span><span class="p">(</span><span class="n">Xika_elements</span><span class="p">,</span><span class="n">indices</span><span class="p">,</span><span class="n">Xika</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Put matrix values back into template matrix according to sets of indices.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Xika_elements : numpy.ndarray</span>
<span class="sd">        A guess in the value of the elements</span>
<span class="sd">    indices : list[list]</span>
<span class="sd">        A list of sets of (component, bead, site) to identify the values of the Xika matrix that are being fit</span>
<span class="sd">    Xika : numpy.ndarray</span>
<span class="sd">        A template matrix of the fraction of molecules of component i that are not bonded at a site of type a on group k.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Xika : numpy.ndarray</span>
<span class="sd">        The final matrix of the fraction of molecules of component i that are not bonded at a site of type a on group k,</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Xika_elements</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of elements should each have a corresponding set of indices.&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Number of elements should each have a corresponding set of indices.&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">ind</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
        <span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="n">ind</span>
        <span class="n">Xika</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">Xika_elements</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">Xika</span></div>

<span class="c1">############################################################</span>
<span class="c1">#                                                          #</span>
<span class="c1">#            Total A, Helmholtz Free Energy                #</span>
<span class="c1">#                                                          #</span>
<span class="c1">############################################################</span>

<div class="viewcode-block" id="calc_A"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_A.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_A">[docs]</a><span class="k">def</span> <span class="nf">calc_A</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">beads</span><span class="p">,</span> <span class="n">beadlibrary</span><span class="p">,</span> <span class="n">massi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">xsk</span><span class="p">,</span> <span class="n">xskl</span><span class="p">,</span> <span class="n">dkk</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">sigmakl</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">l_akl</span><span class="p">,</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">Ckl</span><span class="p">,</span> <span class="n">x0kl</span><span class="p">,</span><span class="n">epsilonHB</span><span class="p">,</span> <span class="n">Kklab</span><span class="p">,</span> <span class="n">nk</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates total Helmholtz energy, :math:`\frac{A}{N k_{B} T}`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rho : numpy.ndarray</span>
<span class="sd">        Number density of system [molecules/m^3]</span>
<span class="sd">    xi : numpy.ndarray</span>
<span class="sd">        Mole fraction of each component, sum(xi) should equal 1.0</span>
<span class="sd">    T : float</span>
<span class="sd">        Temperature of the system [K]</span>
<span class="sd">    beads : list[str]</span>
<span class="sd">        List of unique bead names used among components</span>
<span class="sd">    beadlibrary : dict</span>
<span class="sd">        A dictionary where bead names are the keys to access EOS self interaction parameters:</span>

<span class="sd">        * epsilon: :math:`\epsilon_{k,k}/k_B`, Energy well depth scaled by Boltzmann constant</span>
<span class="sd">        * sigma: :math:`\sigma_{k,k}`, Size parameter [m]</span>
<span class="sd">        * mass: Bead mass [kg/mol]</span>
<span class="sd">        * l_r: :math:`\lambda^{r}_{k,k}`, Exponent of repulsive term between groups of type k</span>
<span class="sd">        * l_a: :math:`\lambda^{a}_{k,k}`, Exponent of attractive term between groups of type k</span>
<span class="sd">        * Sk: :math:`S_{k}`, Shape parameter of group k</span>
<span class="sd">        * Vks: :math:`V_{k,s}`, Number of groups, k, in component</span>
<span class="sd">    massi : numpy.ndarray</span>
<span class="sd">        Mass for each component [kg/mol]</span>
<span class="sd">    nui : numpy.array</span>
<span class="sd">        :math:`\nu_{i,k}/k_B`, Array of number of components by number of bead types. Defines the number of each type of group in each component. </span>
<span class="sd">    Cmol2seg : float</span>
<span class="sd">        Conversion factor from from molecular number density, :math:`\rho`, to segment (i.e. group) number density, :math:`\rho_S`. Shown in eq. 13</span>
<span class="sd">    xsk : numpy.ndarray</span>
<span class="sd">        Mole fraction of each bead (i.e. segment or group), sum(xsk) should equal 1.0</span>
<span class="sd">    xskl : numpy.ndarray</span>
<span class="sd">        Matrix of mole fractions of bead (i.e. segment or group) k multiplied by bead l</span>
<span class="sd">    dkk : numpy.ndarray</span>
<span class="sd">        Array of hard sphere diameters for each group</span>
<span class="sd">    epsilonkl : numpy.ndarray</span>
<span class="sd">        Matrix of well depths for groups (k,l)</span>
<span class="sd">    sigmakl : numpy.ndarray</span>
<span class="sd">        Matrix of mie diameter for groups (k,l)</span>
<span class="sd">    dkl : numpy.ndarray</span>
<span class="sd">        Matrix of hardsphere diameters for groups (k,l)</span>
<span class="sd">    l_akl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential attractive exponents for k,l groups</span>
<span class="sd">    l_rkl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential attractive exponents for k,l groups</span>
<span class="sd">    Ckl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential prefactors for k,l groups</span>
<span class="sd">    x0kl : numpy.ndarray</span>
<span class="sd">        Matrix of sigmakl/dkl, sigmakl is the mie radius for groups (k,l)</span>
<span class="sd">    epsilonHB : numpy.ndarray</span>
<span class="sd">        Interaction energy between each bead and association site.</span>
<span class="sd">    Kklab : numpy.ndarray </span>
<span class="sd">        Bonding volume between each association site</span>
<span class="sd">    nk : numpy.ndarray</span>
<span class="sd">        For each bead the number of each type of site</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A : numpy.ndarray</span>
<span class="sd">        Total Helmholtz energy, length of array rho</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Mole fractions cannot be less than zero.&quot;</span><span class="p">)</span>

    <span class="n">Aideal</span> <span class="o">=</span> <span class="n">calc_Aideal</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">massi</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">AHS</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">A3</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">zetaxstar</span><span class="p">,</span> <span class="n">KHS</span> <span class="o">=</span> <span class="n">calc_Amono</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">xsk</span><span class="p">,</span> <span class="n">xskl</span><span class="p">,</span> <span class="n">dkk</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span><span class="n">epsilonkl</span><span class="p">,</span> <span class="n">sigmakl</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">l_akl</span><span class="p">,</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">Ckl</span><span class="p">,</span> <span class="n">x0kl</span><span class="p">)</span>
    <span class="n">Achain</span><span class="p">,</span> <span class="n">sigmaii_avg</span><span class="p">,</span> <span class="n">epsilonii_avg</span> <span class="o">=</span> <span class="n">calc_Achain</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">sigmakl</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">xskl</span><span class="p">,</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">l_akl</span><span class="p">,</span> <span class="n">beads</span><span class="p">,</span> <span class="n">beadlibrary</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">zetaxstar</span><span class="p">,</span> <span class="n">KHS</span><span class="p">)</span>

    <span class="n">indices</span> <span class="o">=</span> <span class="n">assoc_site_indices</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">nk</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">indices</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">+=</span> <span class="n">epsilonHB</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="k">if</span> <span class="n">tmp</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">Aassoc</span> <span class="o">=</span> <span class="n">calc_A_assoc</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">xskl</span><span class="p">,</span> <span class="n">sigmakl</span><span class="p">,</span> <span class="n">sigmaii_avg</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">epsilonHB</span><span class="p">,</span> <span class="n">Kklab</span><span class="p">,</span> <span class="n">nk</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">Aideal</span> <span class="o">+</span> <span class="n">AHS</span> <span class="o">+</span> <span class="n">A1</span> <span class="o">+</span> <span class="n">A2</span> <span class="o">+</span> <span class="n">A3</span> <span class="o">+</span> <span class="n">Achain</span> <span class="o">+</span> <span class="n">Aassoc</span>
    <span class="c1"># NoteHere</span>
     <span class="c1">#   nrho = int(len(A)/2)</span>
     <span class="c1">#   plt.plot(rho[:nrho],Aideal[:nrho]-Aideal[nrho:],&quot;b&quot;,linewidth=1)</span>
     <span class="c1">#   plt.plot(rho[:nrho],AHS[:nrho]-AHS[nrho:],&quot;r&quot;,linewidth=1)</span>
     <span class="c1">#   plt.plot(rho[:nrho],A1[:nrho]-A1[nrho:],&quot;g&quot;,linewidth=1)</span>
     <span class="c1">#   plt.plot(rho[:nrho],A2[:nrho]-A2[nrho:],&quot;c&quot;,linewidth=1)</span>
     <span class="c1">#   plt.plot(rho[:nrho],A3[:nrho]-A3[nrho:],&quot;m&quot;,linewidth=1)</span>
     <span class="c1">#   plt.plot(rho[:nrho],Achain[:nrho]-Achain[nrho:],&quot;y&quot;,linewidth=1)</span>
     <span class="c1">#   plt.plot(rho[:nrho],Aassoc[:nrho]-Aassoc[nrho:],&quot;k&quot;,linewidth=1)</span>
     <span class="c1">#   plt.plot(rho[:nrho],A[:nrho]-A[nrho:],&quot;k&quot;,linewidth=2)</span>
     <span class="c1">#   plt.show()</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">Aideal</span> <span class="o">+</span> <span class="n">AHS</span> <span class="o">+</span> <span class="n">A1</span> <span class="o">+</span> <span class="n">A2</span> <span class="o">+</span> <span class="n">A3</span> <span class="o">+</span> <span class="n">Achain</span>

    <span class="k">return</span> <span class="n">A</span></div>


<div class="viewcode-block" id="calc_Ares"><a class="viewcode-back" href="../../../../_autosummary/despasito.equations_of_state.saft.gamma_mie_funcs.calc_Ares.html#despasito.equations_of_state.saft.gamma_mie_funcs.calc_Ares">[docs]</a><span class="k">def</span> <span class="nf">calc_Ares</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">beads</span><span class="p">,</span> <span class="n">beadlibrary</span><span class="p">,</span> <span class="n">massi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">xsk</span><span class="p">,</span> <span class="n">xskl</span><span class="p">,</span> <span class="n">dkk</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">sigmakl</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">l_akl</span><span class="p">,</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">Ckl</span><span class="p">,</span> <span class="n">x0kl</span><span class="p">,</span> <span class="n">epsilonHB</span><span class="p">,</span> <span class="n">Kklab</span><span class="p">,</span> <span class="n">nk</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates residual Helmholtz energy, :math:`\frac{A^{res.}}{N k_{B} T}` that deviates from ideal</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rho : numpy.ndarray</span>
<span class="sd">        Number density of system [molecules/m^3]</span>
<span class="sd">    xi : numpy.ndarray</span>
<span class="sd">        Mole fraction of each component, sum(xi) should equal 1.0</span>
<span class="sd">    T : float</span>
<span class="sd">        Temperature of the system [K]</span>
<span class="sd">    beads : list[str]</span>
<span class="sd">        List of unique bead names used among components</span>
<span class="sd">    beadlibrary : dict</span>
<span class="sd">        A dictionary where bead names are the keys to access EOS self interaction parameters:</span>

<span class="sd">        * epsilon: :math:`\epsilon_{k,k}/k_B`, Energy well depth scaled by Boltzmann constant</span>
<span class="sd">        * sigma: :math:`\sigma_{k,k}`, Size parameter [m]</span>
<span class="sd">        * mass: Bead mass [kg/mol]</span>
<span class="sd">        * l_r: :math:`\lambda^{r}_{k,k}`, Exponent of repulsive term between groups of type k</span>
<span class="sd">        * l_a: :math:`\lambda^{a}_{k,k}`, Exponent of attractive term between groups of type k</span>
<span class="sd">        * Sk: :math:`S_{k}`, Shape parameter of group k</span>
<span class="sd">        * Vks: :math:`V_{k,s}`, Number of groups, k, in component</span>
<span class="sd">    massi : numpy.ndarray</span>
<span class="sd">        Mass for each component [kg/mol]</span>
<span class="sd">    nui : numpy.array</span>
<span class="sd">        :math:`\nu_{i,k}/k_B`, Array of number of components by number of bead types. Defines the number of each type of group in each component. </span>
<span class="sd">    Cmol2seg : float</span>
<span class="sd">        Conversion factor from from molecular number density, :math:`\rho`, to segment (i.e. group) number density, :math:`\rho_S`. Shown in eq. 13</span>
<span class="sd">    xsk : numpy.ndarray</span>
<span class="sd">        Mole fraction of each bead (i.e. segment or group), sum(xsk) should equal 1.0</span>
<span class="sd">    xskl : numpy.ndarray</span>
<span class="sd">        Matrix of mole fractions of bead (i.e. segment or group) k multiplied by bead l</span>
<span class="sd">    dkk : numpy.ndarray</span>
<span class="sd">        Array of hard sphere diameters for each group</span>
<span class="sd">    epsilonkl : numpy.ndarray</span>
<span class="sd">        Matrix of well depths for groups (k,l)</span>
<span class="sd">    sigmakl : numpy.ndarray</span>
<span class="sd">        Matrix of mie diameter for groups (k,l)</span>
<span class="sd">    dkl : numpy.ndarray</span>
<span class="sd">        Matrix of hardsphere diameters for groups (k,l)</span>
<span class="sd">    l_akl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential attractive exponents for k,l groups</span>
<span class="sd">    l_rkl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential attractive exponents for k,l groups</span>
<span class="sd">    Ckl : numpy.ndarray</span>
<span class="sd">        Matrix of mie potential prefactors for k,l groups</span>
<span class="sd">    x0kl : numpy.ndarray</span>
<span class="sd">        Matrix of sigmakl/dkl, sigmakl is the mie radius for groups (k,l)</span>
<span class="sd">    epsilonHB : numpy.ndarray</span>
<span class="sd">        Interaction energy between each bead and association site.</span>
<span class="sd">    Kklab : numpy.ndarray </span>
<span class="sd">        Bonding volume between each association site</span>
<span class="sd">    nk : numpy.ndarray</span>
<span class="sd">        For each bead the number of each type of site</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Ares : numpy.ndarray</span>
<span class="sd">        Residual Helmholtz energy that deviates from Aideal, length of array rho</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Mole fractions cannot be less than zero.&quot;</span><span class="p">)</span>

    <span class="n">AHS</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">A3</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">zetaxstar</span><span class="p">,</span> <span class="n">KHS</span> <span class="o">=</span> <span class="n">calc_Amono</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">xsk</span><span class="p">,</span> <span class="n">xskl</span><span class="p">,</span> <span class="n">dkk</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">sigmakl</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">l_akl</span><span class="p">,</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">Ckl</span><span class="p">,</span> <span class="n">x0kl</span><span class="p">)</span>
    <span class="n">Achain</span><span class="p">,</span> <span class="n">sigmaii_avg</span><span class="p">,</span> <span class="n">epsilonii_avg</span> <span class="o">=</span> <span class="n">calc_Achain</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">Cmol2seg</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">sigmakl</span><span class="p">,</span> <span class="n">epsilonkl</span><span class="p">,</span> <span class="n">dkl</span><span class="p">,</span> <span class="n">xskl</span><span class="p">,</span> <span class="n">l_rkl</span><span class="p">,</span> <span class="n">l_akl</span><span class="p">,</span> <span class="n">beads</span><span class="p">,</span> <span class="n">beadlibrary</span><span class="p">,</span> <span class="n">zetax</span><span class="p">,</span> <span class="n">zetaxstar</span><span class="p">,</span> <span class="n">KHS</span><span class="p">)</span>

    <span class="n">indices</span> <span class="o">=</span> <span class="n">assoc_site_indices</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">nk</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">indices</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">+=</span> <span class="n">epsilonHB</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="k">if</span> <span class="n">tmp</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">Aassoc</span> <span class="o">=</span> <span class="n">calc_A_assoc</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">nui</span><span class="p">,</span> <span class="n">xskl</span><span class="p">,</span> <span class="n">sigmakl</span><span class="p">,</span> <span class="n">sigmaii_avg</span><span class="p">,</span> <span class="n">epsilonii_avg</span><span class="p">,</span> <span class="n">epsilonHB</span><span class="p">,</span> <span class="n">Kklab</span><span class="p">,</span> <span class="n">nk</span><span class="p">)</span>
        <span class="n">Ares</span> <span class="o">=</span> <span class="n">AHS</span> <span class="o">+</span> <span class="n">A1</span> <span class="o">+</span> <span class="n">A2</span> <span class="o">+</span> <span class="n">A3</span> <span class="o">+</span> <span class="n">Achain</span> <span class="o">+</span> <span class="n">Aassoc</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Ares</span> <span class="o">=</span> <span class="n">AHS</span> <span class="o">+</span> <span class="n">A1</span> <span class="o">+</span> <span class="n">A2</span> <span class="o">+</span> <span class="n">A3</span> <span class="o">+</span> <span class="n">Achain</span>

    <span class="k">return</span> <span class="n">Ares</span></div>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Jennifer A Clark. Project structure based on the Computational Molecular Science Python Cookiecutter version 1.0

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>